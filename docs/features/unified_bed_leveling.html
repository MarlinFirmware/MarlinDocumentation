<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="flattr:id" content="e7nqg5"> <title>Unified Bed Leveling | Marlin Firmware</title> <meta property="og:title" content="Unified Bed Leveling"> <meta name="author" content="Bob-the-Kuhn, thinkyhead, Roxy-3D, bjarchi"> <meta property="og:locale" content="en_US"> <meta name="description" content="The Unified Auto Bed Leveling system (UBL) provides automated procedures to probe the bed and compensate for an irregular or tilted bed"> <meta property="og:description" content="The Unified Auto Bed Leveling system (UBL) provides automated procedures to probe the bed and compensate for an irregular or tilted bed"> <link rel="canonical" href="http://marlinfw.org/docs/features/unified_bed_leveling.html"> <meta property="og:url" content="http://marlinfw.org/docs/features/unified_bed_leveling.html"> <meta property="og:site_name" content="Marlin Firmware"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2019-07-14T10:25:17+01:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@MarlinFirmware"> <meta name="twitter:creator" content="@Bob-the-Kuhn, thinkyhead, Roxy-3D, bjarchi"> <script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Unified Bed Leveling","author":{"@type":"Person","name":"Bob-the-Kuhn, thinkyhead, Roxy-3D, bjarchi"},"datePublished":"2019-07-14T10:25:17+01:00","dateModified":"2019-07-14T10:25:17+01:00","description":"The Unified Auto Bed Leveling system (UBL) provides automated procedures to probe the bed and compensate for an irregular or tilted bed","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://marlinfw.org/assets/images/logo/marlin/small.png"},"name":"Bob-the-Kuhn, thinkyhead, Roxy-3D, bjarchi"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://marlinfw.org/docs/features/unified_bed_leveling.html"},"url":"http://marlinfw.org/docs/features/unified_bed_leveling.html"}</script> <link rel="icon" href="/assets/favicon.ico"> <link rel="stylesheet" href="/assets/stylesheets/main.css"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script src="/assets/javascript/head.min.js"></script> <script type="text/javascript">
      /**
       * As Github pages do not support https for custom domains
       * this is the current best workaround for #18.
       */
      var domains  = [ 'marlinfw.org', 'localhost', '127.0.0.1' ];
      var pathname = location.pathname.replace(/^\/MarlinDocumentation/, '')
      if (domains.indexOf(window.location.hostname) == -1)
          window.top.location.href = 'http://marlinfw.org' + pathname;

      /**
       * Another ugly workaround trying to improve UX reported by #35
       */
      if (location.protocol != 'http:')
        location.href = 'http:' + window.location.href.substring(window.location.protocol.length);

      /**
       * Improves overall speed by loading javascript and css resources in parallel
       * with the main page.
       */
      head.load(
          "/assets/stylesheets/font-awesome.min.css",

          "/assets/javascript/jquery-2.2.1.min.js",
          "/assets/javascript/jquery-ui.min.js",
          "/assets/javascript/bootstrap.min.js",
          "/assets/javascript/tocify.min.js",
          "/assets/javascript/search.js",
          "/assets/javascript/custom.js",

          "/assets/javascript/sheetrock.min.js",
          "/assets/javascript/cookieconsent.min.js"
      );

      head.ready(function() {
        window.cookieconsent_options = {
          "message":"We use cookies to ensure you get the best experience on our website",
          "dismiss": "Got it!", "learnMore": "More info", "link":"", "theme": "dark-bottom"
        };
      });
    </script> </head> <body role="document"> <nav class="navbar navbar-default navbar-fixed-top custom-no-margin"> <div class="container"> <div class="navbar-header"> <a href="/" class="navbar-brand"> <img src="/assets/images/logo/marlin/text-25.png" alt="Marlin"> </a> <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> </div> <div class="navbar-collapse collapse" id="navbar-main"> <ul class="nav navbar-nav"> <li><a href="/docs/basics/introduction.html">About Marlin</a></li> <li><a href="/meta/download/">Download</a></li> <li><a href="/docs/configuration/configuration.html">Configure</a></li> <li><a href="/docs/basics/install.html">Install</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-tools">Tools <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/tools/u8glib/converter.html">Bitmap Converter</a></li> <li><a href="/tools/lin_advance/k-factor.html">K-Factor Calibration Pattern</a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin/issues">Bugtracker</a></li> <li><a href="/docs/basics/reporting_bugs.html">Reporting bugs</a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin">Source Code Repository</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-documentation">Documentation <span class="caret"></span></a> <ul class="dropdown-menu"> <li class="dropdown-submenu configuration"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration</a> <ul class="dropdown-menu"> <li><a href="/meta/configuration/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/configuration/configuration.html">Configuring Marlin</a></li> <li><a href="/docs/configuration/laser_spindle.html">Laser/Spindle Configuration</a></li> <li><a href="/docs/configuration/probes.html">Probe Configuration</a></li> </ul> </li> <li class="dropdown-submenu development"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development</a> <ul class="dropdown-menu"> <li><a href="/meta/development/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/development/boards.html">Boards</a></li> <li class="divider"> </li> <li><a href="/docs/development/coding_standards.html">Coding Standards</a></li> <li><a href="/docs/development/getting_started_pull_requests.html">Contributing Code with Pull Requests</a></li> <li><a href="/docs/development/git_scripts.html">Marlin Github Scripts</a></li> <li class="divider"> </li> <li><a href="/docs/development/contributing.html">Contributing to Marlin</a></li> <li><a href="/docs/development/feature_request.html">Feature requests</a></li> <li class="divider"> </li> <li><a href="/docs/development/fonts.html">Adding new fonts</a></li> <li><a href="/docs/development/lcd_language.html">LCD Language System</a></li> </ul> </li> <li class="dropdown-submenu features"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features</a> <ul class="dropdown-menu"> <li><a href="/meta/features/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/features/auto_bed_leveling.html">Automatic Bed Leveling</a></li> <li><a href="/docs/features/unified_bed_leveling.html">Unified Bed Leveling</a></li> <li class="divider"> </li> <li><a href="/docs/features/fwretract.html">Firmware Retract</a></li> <li><a href="/docs/features/lin_advance.html">Linear Advance</a></li> <li class="divider"> </li> <li><a href="/docs/features/lcd_menu.html">LCD Menu Tree</a></li> </ul> </li> <li class="dropdown-submenu gcode"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">G-code</a> <ul class="dropdown-menu"> <li><a href="/meta/gcode/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/gcode/G000-G001.html"> <strong>G0-G1</strong>: Linear Move </a></li> <li><a href="/docs/gcode/G002-G003.html"> <strong>G2-G3</strong>: Controlled Arc Move </a></li> <li><a href="/docs/gcode/G004.html"> <strong>G4</strong>: Dwell </a></li> <li><a href="/docs/gcode/G005.html"> <strong>G5</strong>: Bézier cubic spline </a></li> <li><a href="/docs/gcode/G010.html"> <strong>G10</strong>: Retract </a></li> <li><a href="/docs/gcode/G011.html"> <strong>G11</strong>: Recover </a></li> <li><a href="/docs/gcode/G012.html"> <strong>G12</strong>: Clean the Nozzle </a></li> <li><a href="/docs/gcode/G020.html"> <strong>G20</strong>: Inch Units </a></li> <li><a href="/docs/gcode/G021.html"> <strong>G21</strong>: Millimeter Units </a></li> <li><a href="/docs/gcode/G026.html"> <strong>G26</strong>: Mesh Validation Pattern </a></li> <li><a href="/docs/gcode/G027.html"> <strong>G27</strong>: Park toolhead </a></li> <li><a href="/docs/gcode/G028.html"> <strong>G28</strong>: Auto Home </a></li> <li><a href="/docs/gcode/G029-mbl.html"> <strong>G29</strong>: Bed Leveling (Manual) </a></li> <li><a href="/docs/gcode/G029-abl.html"> <strong>G29</strong>: Bed Leveling (Automatic) </a></li> <li><a href="/docs/gcode/G029-ubl.html"> <strong>G29</strong>: Bed Leveling (Unified) </a></li> <li><a href="/docs/gcode/G030.html"> <strong>G30</strong>: Single Z-Probe </a></li> <li><a href="/docs/gcode/G031.html"> <strong>G31</strong>: Dock Sled </a></li> <li><a href="/docs/gcode/G032.html"> <strong>G32</strong>: Undock Sled </a></li> <li><a href="/docs/gcode/G033.html"> <strong>G33</strong>: Delta Auto Calibration </a></li> <li><a href="/docs/gcode/G038.html"> <strong>G38.2-G38.3</strong>: Probe target </a></li> <li><a href="/docs/gcode/G042.html"> <strong>G42</strong>: Move to mesh coordinate </a></li> <li><a href="/docs/gcode/G053.html"> <strong>G53</strong>: Move in Machine Coordinates </a></li> <li><a href="/docs/gcode/G054-059.html"> <strong>G54-G55</strong>: Workspace Coordinate System </a></li> <li><a href="/docs/gcode/G090.html"> <strong>G90</strong>: Absolute Positioning </a></li> <li><a href="/docs/gcode/G091.html"> <strong>G91</strong>: Relative Positioning </a></li> <li><a href="/docs/gcode/G092.html"> <strong>G92</strong>: Set Position </a></li> <li><a href="/docs/gcode/G425.html"> <strong>G425</strong>: Perform auto-calibration </a></li> <li><a href="/docs/gcode/M000-M001.html"> <strong>M0-M1</strong>: Unconditional stop </a></li> <li><a href="/docs/gcode/M003.html"> <strong>M3</strong>: Spindle CW / Laser On </a></li> <li><a href="/docs/gcode/M004.html"> <strong>M4</strong>: Spindle CCW / Laser On </a></li> <li><a href="/docs/gcode/M005.html"> <strong>M5</strong>: Spindle / Laser Off </a></li> <li><a href="/docs/gcode/M017.html"> <strong>M17</strong>: Enable Steppers </a></li> <li><a href="/docs/gcode/M018.html"> <strong>M18-M84</strong>: Disable steppers </a></li> <li><a href="/docs/gcode/M020.html"> <strong>M20</strong>: List SD Card </a></li> <li><a href="/docs/gcode/M021.html"> <strong>M21</strong>: Init SD card </a></li> <li><a href="/docs/gcode/M022.html"> <strong>M22</strong>: Release SD card </a></li> <li><a href="/docs/gcode/M023.html"> <strong>M23</strong>: Select SD file </a></li> <li><a href="/docs/gcode/M024.html"> <strong>M24</strong>: Start or Resume SD print </a></li> <li><a href="/docs/gcode/M025.html"> <strong>M25</strong>: Pause SD print </a></li> <li><a href="/docs/gcode/M026.html"> <strong>M26</strong>: Set SD position </a></li> <li><a href="/docs/gcode/M027.html"> <strong>M27</strong>: Report SD print status </a></li> <li><a href="/docs/gcode/M028.html"> <strong>M28</strong>: Start SD write </a></li> <li><a href="/docs/gcode/M029.html"> <strong>M29</strong>: Stop SD write </a></li> <li><a href="/docs/gcode/M030.html"> <strong>M30</strong>: Delete SD file </a></li> <li><a href="/docs/gcode/M031.html"> <strong>M31</strong>: Print time </a></li> <li><a href="/docs/gcode/M032.html"> <strong>M32</strong>: Select and Start </a></li> <li><a href="/docs/gcode/M033.html"> <strong>M33</strong>: Get Long Path </a></li> <li><a href="/docs/gcode/M034.html"> <strong>M34</strong>: SDCard Sorting </a></li> <li><a href="/docs/gcode/M042.html"> <strong>M42</strong>: Set Pin State </a></li> <li><a href="/docs/gcode/M043.html"> <strong>M43</strong>: Debug Pins </a></li> <li><a href="/docs/gcode/M043-T.html"> <strong>M43 T</strong>: Toggle Pins </a></li> <li><a href="/docs/gcode/M048.html"> <strong>M48</strong>: Probe Accuracy Test </a></li> <li><a href="/docs/gcode/M073.html"> <strong>M73</strong>: Set Print Progress </a></li> <li><a href="/docs/gcode/M075.html"> <strong>M75</strong>: Start Print Job Timer </a></li> <li><a href="/docs/gcode/M076.html"> <strong>M76</strong>: Pause Print Job </a></li> <li><a href="/docs/gcode/M077.html"> <strong>M77</strong>: Stop Print Job Timer </a></li> <li><a href="/docs/gcode/M078.html"> <strong>M78</strong>: Print Job Stats </a></li> <li><a href="/docs/gcode/M080.html"> <strong>M80</strong>: Power On </a></li> <li><a href="/docs/gcode/M081.html"> <strong>M81</strong>: Power Off </a></li> <li><a href="/docs/gcode/M082.html"> <strong>M82</strong>: E Absolute </a></li> <li><a href="/docs/gcode/M083.html"> <strong>M83</strong>: E Relative </a></li> <li><a href="/docs/gcode/M085.html"> <strong>M85</strong>: Inactivity Shutdown </a></li> <li><a href="/docs/gcode/M092.html"> <strong>M92</strong>: Set Axis Steps-per-unit </a></li> <li><a href="/docs/gcode/M100.html"> <strong>M100</strong>: Free Memory </a></li> <li><a href="/docs/gcode/M104.html"> <strong>M104</strong>: Set Hotend Temperature </a></li> <li><a href="/docs/gcode/M105.html"> <strong>M105</strong>: Report Temperatures </a></li> <li><a href="/docs/gcode/M106.html"> <strong>M106</strong>: Set Fan Speed </a></li> <li><a href="/docs/gcode/M107.html"> <strong>M107</strong>: Fan Off </a></li> <li><a href="/docs/gcode/M108.html"> <strong>M108</strong>: Break and Continue </a></li> <li><a href="/docs/gcode/M109.html"> <strong>M109</strong>: Wait for Hotend Temperature </a></li> <li><a href="/docs/gcode/M110.html"> <strong>M110</strong>: Set Line Number </a></li> <li><a href="/docs/gcode/M111.html"> <strong>M111</strong>: Debug Level </a></li> <li><a href="/docs/gcode/M112.html"> <strong>M112</strong>: Emergency Stop </a></li> <li><a href="/docs/gcode/M113.html"> <strong>M113</strong>: Host Keepalive </a></li> <li><a href="/docs/gcode/M114.html"> <strong>M114</strong>: Get Current Position </a></li> <li><a href="/docs/gcode/M115.html"> <strong>M115</strong>: Firmware Info </a></li> <li><a href="/docs/gcode/M117.html"> <strong>M117</strong>: Set LCD Message </a></li> <li><a href="/docs/gcode/M118.html"> <strong>M118</strong>: Serial print </a></li> <li><a href="/docs/gcode/M119.html"> <strong>M119</strong>: Endstop States </a></li> <li><a href="/docs/gcode/M120.html"> <strong>M120</strong>: Enable Endstops </a></li> <li><a href="/docs/gcode/M121.html"> <strong>M121</strong>: Disable Endstops </a></li> <li><a href="/docs/gcode/M122.html"> <strong>M122</strong>: TMC Debugging </a></li> <li><a href="/docs/gcode/M125.html"> <strong>M125</strong>: Park Head </a></li> <li><a href="/docs/gcode/M126.html"> <strong>M126</strong>: Baricuda 1 Open </a></li> <li><a href="/docs/gcode/M127.html"> <strong>M127</strong>: Baricuda 1 Close </a></li> <li><a href="/docs/gcode/M128.html"> <strong>M128</strong>: Baricuda 2 Open </a></li> <li><a href="/docs/gcode/M129.html"> <strong>M129</strong>: Baricuda 2 Close </a></li> <li><a href="/docs/gcode/M140.html"> <strong>M140</strong>: Set Bed Temperature </a></li> <li><a href="/docs/gcode/M141.html"> <strong>M141</strong>: Set Chamber Temperature </a></li> <li><a href="/docs/gcode/M145.html"> <strong>M145</strong>: Set Material Preset </a></li> <li><a href="/docs/gcode/M149.html"> <strong>M149</strong>: Set Temperature Units </a></li> <li><a href="/docs/gcode/M150.html"> <strong>M150</strong>: Set RGB(W) Color </a></li> <li><a href="/docs/gcode/M155.html"> <strong>M155</strong>: Temperature Auto-Report </a></li> <li><a href="/docs/gcode/M163.html"> <strong>M163</strong>: Set Mix Factor </a></li> <li><a href="/docs/gcode/M164.html"> <strong>M164</strong>: Save Mix </a></li> <li><a href="/docs/gcode/M165.html"> <strong>M165</strong>: Set Mix </a></li> <li><a href="/docs/gcode/M166.html"> <strong>M166</strong>: Gradient Mix </a></li> <li><a href="/docs/gcode/M190.html"> <strong>M190</strong>: Wait for Bed Temperature </a></li> <li><a href="/docs/gcode/M200.html"> <strong>M200</strong>: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M201.html"> <strong>M201</strong>: Set Print Max Acceleration </a></li> <li><a href="/docs/gcode/M203.html"> <strong>M203</strong>: Set Max Feedrate </a></li> <li><a href="/docs/gcode/M204.html"> <strong>M204</strong>: Set Starting Acceleration </a></li> <li><a href="/docs/gcode/M205.html"> <strong>M205</strong>: Set Advanced Settings </a></li> <li><a href="/docs/gcode/M206.html"> <strong>M206</strong>: Set Home Offsets </a></li> <li><a href="/docs/gcode/M207.html"> <strong>M207</strong>: Set Firmware Retraction </a></li> <li><a href="/docs/gcode/M208.html"> <strong>M208</strong>: Firmware Recover </a></li> <li><a href="/docs/gcode/M209.html"> <strong>M209</strong>: Set Auto Retract </a></li> <li><a href="/docs/gcode/M211.html"> <strong>M211</strong>: Software Endstops </a></li> <li><a href="/docs/gcode/M217.html"> <strong>M217</strong>: Filament swap parameters </a></li> <li><a href="/docs/gcode/M218.html"> <strong>M218</strong>: Set Hotend Offset </a></li> <li><a href="/docs/gcode/M220.html"> <strong>M220</strong>: Set Feedrate Percentage </a></li> <li><a href="/docs/gcode/M221.html"> <strong>M221</strong>: Set Flow Percentage </a></li> <li><a href="/docs/gcode/M226.html"> <strong>M226</strong>: Wait for Pin State </a></li> <li><a href="/docs/gcode/M240.html"> <strong>M240</strong>: Trigger Camera </a></li> <li><a href="/docs/gcode/M250.html"> <strong>M250</strong>: LCD Contrast </a></li> <li><a href="/docs/gcode/M260.html"> <strong>M260</strong>: I2C Send </a></li> <li><a href="/docs/gcode/M261.html"> <strong>M261</strong>: I2C Request </a></li> <li><a href="/docs/gcode/M280.html"> <strong>M280</strong>: Servo Position </a></li> <li><a href="/docs/gcode/M290.html"> <strong>M290</strong>: Babystep </a></li> <li><a href="/docs/gcode/M300.html"> <strong>M300</strong>: Play Tone </a></li> <li><a href="/docs/gcode/M301.html"> <strong>M301</strong>: Set Hotend PID </a></li> <li><a href="/docs/gcode/M302.html"> <strong>M302</strong>: Cold Extrude </a></li> <li><a href="/docs/gcode/M303.html"> <strong>M303</strong>: PID autotune </a></li> <li><a href="/docs/gcode/M304.html"> <strong>M304</strong>: Set Bed PID </a></li> <li><a href="/docs/gcode/M350.html"> <strong>M350</strong>: Set micro-stepping </a></li> <li><a href="/docs/gcode/M351.html"> <strong>M351</strong>: Set Microstep Pins </a></li> <li><a href="/docs/gcode/M355.html"> <strong>M355</strong>: Case Light Control </a></li> <li><a href="/docs/gcode/M360.html"> <strong>M360</strong>: SCARA Theta A </a></li> <li><a href="/docs/gcode/M361.html"> <strong>M361</strong>: SCARA Theta-B </a></li> <li><a href="/docs/gcode/M362.html"> <strong>M362</strong>: SCARA Psi-A </a></li> <li><a href="/docs/gcode/M363.html"> <strong>M363</strong>: SCARA Psi-B </a></li> <li><a href="/docs/gcode/M364.html"> <strong>M364</strong>: SCARA Psi-C </a></li> <li><a href="/docs/gcode/M380.html"> <strong>M380</strong>: Activate Solenoid </a></li> <li><a href="/docs/gcode/M381.html"> <strong>M381</strong>: Deactivate Solenoids </a></li> <li><a href="/docs/gcode/M400.html"> <strong>M400</strong>: Finish Moves </a></li> <li><a href="/docs/gcode/M401.html"> <strong>M401</strong>: Deploy Probe </a></li> <li><a href="/docs/gcode/M402.html"> <strong>M402</strong>: Stow Probe </a></li> <li><a href="/docs/gcode/M403.html"> <strong>M403</strong>: MMU2 Filament Type </a></li> <li><a href="/docs/gcode/M404.html"> <strong>M404</strong>: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M405.html"> <strong>M405</strong>: Filament Width Sensor On </a></li> <li><a href="/docs/gcode/M406.html"> <strong>M406</strong>: Filament Width Sensor Off </a></li> <li><a href="/docs/gcode/M407.html"> <strong>M407</strong>: Filament Width </a></li> <li><a href="/docs/gcode/M410.html"> <strong>M410</strong>: Quickstop </a></li> <li><a href="/docs/gcode/M412.html"> <strong>M412</strong>: Filament Runout </a></li> <li><a href="/docs/gcode/M413.html"> <strong>M413</strong>: Power-loss Recovery </a></li> <li><a href="/docs/gcode/M420.html"> <strong>M420</strong>: Bed Leveling State </a></li> <li><a href="/docs/gcode/M421.html"> <strong>M421</strong>: Set Mesh Value </a></li> <li><a href="/docs/gcode/M425.html"> <strong>M425</strong>: Backlash compensation </a></li> <li><a href="/docs/gcode/M428.html"> <strong>M428</strong>: Home Offsets Here </a></li> <li><a href="/docs/gcode/M500.html"> <strong>M500</strong>: Save Settings </a></li> <li><a href="/docs/gcode/M501.html"> <strong>M501</strong>: Restore Settings </a></li> <li><a href="/docs/gcode/M502.html"> <strong>M502</strong>: Factory Reset </a></li> <li><a href="/docs/gcode/M503.html"> <strong>M503</strong>: Report Settings </a></li> <li><a href="/docs/gcode/M504.html"> <strong>M504</strong>: Validate EEPROM contents </a></li> <li><a href="/docs/gcode/M524.html"> <strong>M524</strong>: Abort SD print </a></li> <li><a href="/docs/gcode/M540.html"> <strong>M540</strong>: Endstops Abort SD </a></li> <li><a href="/docs/gcode/M569.html"> <strong>M569</strong>: Set TMC stepping mode </a></li> <li><a href="/docs/gcode/M600.html"> <strong>M600</strong>: Filament Change </a></li> <li><a href="/docs/gcode/M603.html"> <strong>M603</strong>: Configure Filament Change </a></li> <li><a href="/docs/gcode/M605.html"> <strong>M605</strong>: Dual Nozzle Mode </a></li> <li><a href="/docs/gcode/M665.html"> <strong>M665</strong>: Delta Configuration </a></li> <li><a href="/docs/gcode/M665-scara.html"> <strong>M665</strong>: SCARA Configuration </a></li> <li><a href="/docs/gcode/M666.html"> <strong>M666</strong>: Set Delta endstop adjustments </a></li> <li><a href="/docs/gcode/M666-dual.html"> <strong>M666</strong>: Set dual endstop offsets </a></li> <li><a href="/docs/gcode/M701.html"> <strong>M701</strong>: Load filament </a></li> <li><a href="/docs/gcode/M702.html"> <strong>M702</strong>: Unload filament </a></li> <li><a href="/docs/gcode/M851.html"> <strong>M851</strong>: Z Probe Offset </a></li> <li><a href="/docs/gcode/M852.html"> <strong>M852</strong>: Bed Skew Compensation </a></li> <li><a href="/docs/gcode/M900.html"> <strong>M900</strong>: Linear Advance Factor </a></li> <li><a href="/docs/gcode/M906.html"> <strong>M906</strong>: TMC Motor Current </a></li> <li><a href="/docs/gcode/M907.html"> <strong>M907</strong>: Set Motor Current </a></li> <li><a href="/docs/gcode/M908.html"> <strong>M908</strong>: Set Trimpot Pins </a></li> <li><a href="/docs/gcode/M909.html"> <strong>M909</strong>: DAC Print Values </a></li> <li><a href="/docs/gcode/M910.html"> <strong>M910</strong>: Commit DAC to EEPROM </a></li> <li><a href="/docs/gcode/M911.html"> <strong>M911</strong>: TMC OT Pre-Warn Condition </a></li> <li><a href="/docs/gcode/M912.html"> <strong>M912</strong>: Clear TMC OT Pre-Warn </a></li> <li><a href="/docs/gcode/M913.html"> <strong>M913</strong>: Set Hybrid Threshold Speed </a></li> <li><a href="/docs/gcode/M914.html"> <strong>M914</strong>: TMC Bump Sensitivity </a></li> <li><a href="/docs/gcode/M915.html"> <strong>M915</strong>: TMC Z axis calibration </a></li> <li><a href="/docs/gcode/M928.html"> <strong>M928</strong>: Start SD Logging </a></li> <li><a href="/docs/gcode/M999.html"> <strong>M999</strong>: STOP Restart </a></li> <li><a href="/docs/gcode/M7219.html"> <strong>M7219</strong>: MAX7219 Control </a></li> </ul> </li> <li class="dropdown-submenu hardware"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware</a> <ul class="dropdown-menu"> <li><a href="/meta/hardware/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/hardware/boards.html">Boards</a></li> <li class="divider"> </li> <li><a href="/docs/hardware/endstops.html">Endstops</a></li> <li><a href="/docs/hardware/tmc_drivers.html">Trinamic drivers</a></li> </ul> </li> <li class="dropdown-submenu setting"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Settings</a> <ul class="dropdown-menu"> <li><a href="/meta/setting/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/setting/ComingSoon.html">COMING_SOON</a></li> </ul> </li> <li><a href="/docs/basics/troubleshooting.html">Troubleshooting</a></li> <li class="divider"> </li> <li><a href="/meta/needs-review/">Documentation Needing Review</a></li> </ul> </li> <li id="searchbox"> <form action="/meta/search/"> <input type="search" name="q" placeholder="Search"> </form> </li> </ul> <ul class="nav navbar-nav navbar-right visible-lg-block"> <li> <a href="https://github.com/MarlinFirmware/MarlinDocumentation/edit/master/_features/unified_bed_leveling.md" data-proofer-ignore> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Improve this page</span> </a> </li> </ul> </div> </div> </nav> <div class="container" role="main"> <div class="row"> <div class="col-lg-3 col-md-4 visible-lg-block visible-md-block custom-no-padding"> <div class="custom-fixed-sidebar"> <div id="toc"></div> </div> </div> <div class="col-lg-9 col-md-8 custom-bg-white"> <div class="row"> <div class="col-md-12 custom-article"> <p class="text-right pull-right visible-lg-block hidden-print small custom-pt25"> <a href="https://github.com/Bob-the-Kuhn" data-toggle="tooltip" data-placement="bottom" title="Visit Bob-the-Kuhn's profile on Github"><img class="avatar avatar-small" src="https://avatars0.githubusercontent.com/Bob-the-Kuhn?v=3&amp;s=30" alt="Bob-the-Kuhn" srcset="https://avatars0.githubusercontent.com/Bob-the-Kuhn?v=3&amp;s=30 1x, https://avatars0.githubusercontent.com/Bob-the-Kuhn?v=3&amp;s=60 2x, https://avatars0.githubusercontent.com/Bob-the-Kuhn?v=3&amp;s=90 3x, https://avatars0.githubusercontent.com/Bob-the-Kuhn?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> <a href="https://github.com/thinkyhead" data-toggle="tooltip" data-placement="bottom" title="Visit thinkyhead's profile on Github"><img class="avatar avatar-small" src="https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=30" alt="thinkyhead" srcset="https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=30 1x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=60 2x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=90 3x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> <a href="https://github.com/Roxy-3D" data-toggle="tooltip" data-placement="bottom" title="Visit Roxy-3D's profile on Github"><img class="avatar avatar-small" src="https://avatars2.githubusercontent.com/Roxy-3D?v=3&amp;s=30" alt="Roxy-3D" srcset="https://avatars2.githubusercontent.com/Roxy-3D?v=3&amp;s=30 1x, https://avatars2.githubusercontent.com/Roxy-3D?v=3&amp;s=60 2x, https://avatars2.githubusercontent.com/Roxy-3D?v=3&amp;s=90 3x, https://avatars2.githubusercontent.com/Roxy-3D?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> <a href="https://github.com/bjarchi" data-toggle="tooltip" data-placement="bottom" title="Visit bjarchi's profile on Github"><img class="avatar avatar-small" src="https://avatars3.githubusercontent.com/bjarchi?v=3&amp;s=30" alt="bjarchi" srcset="https://avatars3.githubusercontent.com/bjarchi?v=3&amp;s=30 1x, https://avatars3.githubusercontent.com/bjarchi?v=3&amp;s=60 2x, https://avatars3.githubusercontent.com/bjarchi?v=3&amp;s=90 3x, https://avatars3.githubusercontent.com/bjarchi?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> </p> <h1 class="custom-article-header">Unified Bed Leveling</h1> <div class="container-fluid"> <div class="row alert alert-info custom-alert"> <div class="col-lg-1 col-md-2 visible-lg-block visible-md-block custom-alert-icon"> <i class="fa fa-info-circle fa-4x" aria-hidden="true"></i> </div> <div class="col-lg-11 col-md-10 custom-alert-text"> <p>This page is a work in progress, based on Marlin 1.1.x. Corrections/improvements are welcome.</p> </div> </div> </div> <ul> <li>A comprehensive LCD menu system for UBL is coming soon.</li> <li>See also <a href="http://marlinfw.org/docs/gcode/G026.html">G26 Mesh Validation</a> and <a href="http://marlinfw.org/docs/gcode/G029-ubl.html">G29 for UBL</a>.</li> </ul> <h1 id="ubl-startup-guide">UBL Startup Guide</h1> <p>The <strong>Unified Bed Leveling (UBL)</strong> system is a superset of the previous leveling systems.</p> <p>The main improvements over the previous systems are:</p> <ul> <li>Optimized line-splitting algorithm. For all mesh-based leveling methods, on Cartesians each linear move is split on grid line boundaries, respecting the best-known measured heights on the bed. UBL highly optimizes this boundary-splitting with pre-calculation, optimized handling of special cases, and avoiding recursion.</li> <li>It is possible to probe and store a high-resolution rectangular mesh in nonvolatile storage, load this mesh, and use either 3-point or grid based probing to ‘tilt’ the mesh and compensate for slight changes in bed orientation.</li> <li>The user is able to fill in the portions of the mesh that can’t be reached by automated probing. This allows the entire bed to be compensated.</li> <li>It allows the user to fine tune the system. The user is able to modify the mesh based on print results. Really good first layer adhesion and height can be achieved over the entire bed.</li> </ul> <h2 id="synopsis">Synopsis</h2> <p>Currently an LCD display with a rotary encoder is recommended. Note that the MKS TFT 2.8 and 3.2 <em>do not</em> actually fulfill the LCD requirements. The main documentation below assumes that a conforming LCD and a z-probe are present. See <a href="#ubl-without-an-lcd">the no-lcd addendum</a> for information on using UBL without a display, and <a href="#ubl-without-a-z-probe">the no-z-probe addendum</a> to get UBL working without a z-probe installed. Note that operation without an LCD is still work-in-progress, and subject to change.</p> <p>UBL is a superset of previous automatic leveling systems, but it does not necessarily supersede them in all cases. Its goal is to allow the best features of the previous leveling schemes to be used together and combined, as well as providing a richer set of commands and feedback for the user. However, this functionality comes at a cost of program space. Compared to bilinear leveling, for example, the difference might be 50 kB for UBL vs. 5 kB for bilinear – and for an equally precise mesh the printed results could be quite similar. With that said, the cost in program space is likely only a concern for more resource constrained parts like the 128k ATMegas.</p> <p>The printer must be already fully functional and tested, with a well-constrained movement system. The more physically level and straight the bed is, the better your results will be. See <code class="highlighter-rouge">Configuration.h</code> and <code class="highlighter-rouge">Configuration_adv.h</code> for all of UBL’s settings.</p> <p>You should be able to successfully print a small object at the center of the bed with bed leveling turned off. It’s very important to verify that your <code class="highlighter-rouge">Configuration.h</code> settings make this possible before trying to bring up UBL. Most problems bringing up the UBL Bed Leveling system occur when this step has been ignored. Please pay particular attention to your <code class="highlighter-rouge">Z_PROBE_OFFSET_FROM_EXTRUDER</code> value. Usually it’s best to home the Z-Axis in the center of the bed. But wherever you decide to home, the Z value reported on the LCD (or with <code class="highlighter-rouge">M114</code>) should be <em>very</em> close to 0.0 mm when the nozzle is just touching the bed. Failure to calibrate <code class="highlighter-rouge">Z_PROBE_OFFSET_FROM_EXTRUDER</code> properly will result in dimensional errors in your printed parts.</p> <p>The following command sequence can then be used as a quick-start guide to home, level, and then fine-tune the results. These commands are for a ‘normal’ setup; see the relevant <a href="#addenda">addenda</a> for concerns and gcode sequences related to setups without an lcd or z-probe.:</p> <pre><code class="language-gcode">;------------------------------------------
;--- Setup and initial probing commands ---
;------------------------------------------
M502            ; Reset settings to configuration defaults...
M500            ; ...and Save to EEPROM. Use this on a new install.
M501            ; Read back in the saved EEPROM.  

M190 S65        ; Not required, but having the printer at temperature helps accuracy
M104 S210       ; Not required, but having the printer at temperature helps accuracy

G28             ; Home XYZ.
G29 P1          ; Do automated probing of the bed.
G29 P2 B T      ; Manual probing of locations USUALLY NOT NEEDED!!!!
G29 P3 T        ; Repeat until all mesh points are filled in.

G29 T           ; View the Z compensation values.
G29 S1          ; Save UBL mesh points to EEPROM.
G29 F 10.0      ; Set Fade Height for correction at 10.0 mm.
G29 A           ; Activate the UBL System.
M500            ; Save current setup. WARNING: UBL will be active at power up, before any `G28`.
;---------------------------------------------
;--- Fine Tuning of the mesh happens below ---
;---------------------------------------------
G26 C P5.0 F3.0 ; Produce mesh validation pattern with primed nozzle (5mm) and filament diameter 3mm 
                ; PLA temperatures are assumed unless you specify, e.g., B 105 H 225 for ABS Plastic
G29 P4 T        ; Move nozzle to 'bad' areas and fine tune the values if needed
                ; Repeat G26 and G29 P4 T  commands as needed.

G29 S1          ; Save UBL mesh values to EEPROM.
M500            ; Resave UBL's state information.
;----------------------------------------------------
;--- Use 3-point probe to transform a stored mesh ---
;----------------------------------------------------
G29 L1          ; Load the mesh stored in slot 1 (from G29 S1)
G29 J           ; No size specified on the J option tells G29 to probe the specified 3 points
                ; and tilt the mesh according to what it finds.
</code></pre> <h2 id="scope">Scope</h2> <p>The UBL system contains a suite of tools with multiple options intended to cover almost any situation. This document is aimed at getting a new user acquainted with the most used tools and options needed to produce a high quality print.</p> <p>The intent is to provide a new user with enough knowledge of the UBL system that they can go to the detailed documentation and start working with the other tools and options as needed.</p> <p>The 3-point leveling option is only covered to the extent of using it to transform an already-measured mesh.</p> <h2 id="theory">Theory</h2> <p>UBL projects a rectangular grid over the print bed. A Z height is measured at each point (confluence) in the grid.</p> <p>Linear moves are split at grid boundaries. For each segment the Z offset at start and end are calculated. The Z compensation varies linearly from the start to end of the move.</p> <p>Note that kinematic systems like Delta and SCARA already split moves into very small segments, removing the need to split moves at grid boundaries. In the future, moves may be split into smaller segments on Cartesian also to produce more fine-grained Z height changes through the move.</p> <p>The Z compensation on any grid line is the simple linear interpolation of the Z offsets of the two corners it connects.</p> <p>The Z compensation for any point within a grid box is produced by calculating the bilinear interpolation of the Z offsets of the four corner points. See the addendum <a href="#bilinear-computation">Bilinear computation</a> for details.</p> <p>Tools are provided that can populate the Z compensation values at the mesh points via automated probing, manual probing, and manually entering a value. The intent of UBL is to allow the entire printable area of the bed to have usable Z compensation values.</p> <p>The initial auto bed leveling procedure rarely produces great results across the whole bed. Fine editing tools are used to tune the mesh more finely. UBL includes a test print utility to aid in the tuning process.</p> <h2 id="process-overview">Process overview</h2> <p>To create a mesh that produces good first-layer results over the entire bed, follow this procedure:</p> <ol> <li>Setup the UBL parameters in <code class="highlighter-rouge">Configuration.h</code> and <code class="highlighter-rouge">Configuration_adv.h</code>.</li> <li>Perform automated probing.</li> <li>Perform additional manual probing, if needed.</li> <li>Fill in un-probed points in the mesh</li> <li>Run the test print utility.</li> <li>Fine tune the matrix.</li> <li>Repeat steps 5 and 6 until satisfied.</li> </ol> <p>An LCD controller with rotary encoder, while not required, substantially simplifies the process.</p> <p>The printer (and LCD) must be fully functional before starting this process.</p> <h3 id="ubl-configuration">UBL Configuration</h3> <p>UBL configuration options are located in <code class="highlighter-rouge">Configuration.h</code> and <code class="highlighter-rouge">Configuration_adv.h</code>.</p> <p>Enable these options:</p> <ul> <li> <code class="highlighter-rouge">AUTO_BED_LEVELING_UBL</code>. Leave the others commented out.</li> <li> <code class="highlighter-rouge">G26_MESH_VALIDATION</code> to enable the <code class="highlighter-rouge">G26</code> test print utility.</li> <li> <code class="highlighter-rouge">EEPROM_SETTINGS</code>. <strong>EEPROM support is required.</strong> </li> <li>One of the LCD options. <strong><em>An LCD with a rotary encoder is strongly recommended.</em></strong> </li> </ul> <p><strong>Z Probe XY offsets</strong> should be set to within 1mm of the measured distance from the nozzle to the probe. Ideally the error should be less than +-2mm. Errors of 5mm have been known to cause difficulties in fine-tuning.</p> <p><strong>Travel limits &amp; bed size</strong> tell the system where the nozzle can reach. This is used during automated probing to determine what points the PROBE can reach.</p> <p>All printers require these settings, which specify the physical movement limits for the nozzle:</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="c1">// The size of the print bed
</span><span class="cp">#define X_BED_SIZE xxx
#define Y_BED_SIZE xxx
</span>
<span class="c1">// Travel limits (mm) after homing, corresponding to endstop positions.
</span><span class="cp">#define X_MIN_POS xxx
#define Y_MIN_POS xxx
#define Z_MIN_POS xxx
#define X_MAX_POS xxx
#define Y_MAX_POS xxx
#define Z_MAX_POS xxx
</span></code></pre> </div> <p><strong>Mesh size and density</strong> – These define the default boundaries of the UBL mesh - the region of the bed the nozzle(s) can reach, and therefore needs to be compensated - and the mesh density. These settings can be found in <code class="highlighter-rouge">Configuration.h</code>.</p> <p>Ideally the mesh bounds will match your printable area perfectly. In practice it’s a good idea to pull these in a bit with <code class="highlighter-rouge">MESH_INSET</code> if the printable area goes right up to the edge of the bed. This helps keep the probe from missing the bed.</p> <p>3 x 3 through 15 x 15 meshes are supported. X &amp; Y dimensions do NOT need to be the same. First time users should start out with a small mesh until they are familiar with the tools. Once you’re proficient then move to larger meshes. 7 x 7 seems to be a popular size for a first attempt at a final mesh.</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cp">#define UBL_MESH_INSET 10         // Mesh inset margin on print area
#define GRID_MAX_POINTS_X 3       // Don't use more than 15 points per axis, implementation limited.
#define GRID_MAX_POINTS_Y GRID_MAX_POINTS_X
</span></code></pre> </div> <p>The automated mesh boundary settings assume that the printable area is centered in the physical bed area (as specified below), and just applies an inset to all sides. If your configuration is different then you may need to modify the min/max settings, found in <code class="highlighter-rouge">Configuration_adv.h</code>, to fit your situation. Note though that (unlike bilinear leveling) the MESH_MIN and MESH_MAX positions refer to where the <em>nozzle</em> can reach, not the <em>probe</em>.:</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cp">#define MESH_MIN_X UBL_MESH_INSET
#define MESH_MAX_X (X_BED_SIZE - (UBL_MESH_INSET))
#define MESH_MIN_Y UBL_MESH_INSET
#define MESH_MAX_Y (Y_BED_SIZE - (UBL_MESH_INSET))
</span></code></pre> </div> <p>For delta printers the situation is similar. It is necessary to have grid points defined that can be filled covering the entirety of <code class="highlighter-rouge">DELTA_PRINTABLE_RADIUS</code>, but there should also be a ‘border’ of valid mesh points that lie just outside the printable radius. This ensures that every grid cell within the printable radius will have all four of its corners defined.</p> <p>So however bed size and printable radius are defined, make sure that your mesh grid is defined so that a full circle of ‘extra’ mesh points lie outside of the printable radius.</p> <p><strong>3-point probe positions</strong> - If you plan to use 3-point probing to ‘touch up’ the orientation of a saved mesh then you will also need to make sure that the 3-point leveling probe points are all accessible by your probe.</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cp">#define UBL_PROBE_PT_1_X 39       // Probing points for 3-Point leveling of the mesh
#define UBL_PROBE_PT_1_Y 180
#define UBL_PROBE_PT_2_X 39
#define UBL_PROBE_PT_2_Y 20
#define UBL_PROBE_PT_3_X 180
#define UBL_PROBE_PT_3_Y 20
</span></code></pre> </div> <h3 id="commands">Commands</h3> <p>UBL has a series of “phase” commands that roughly follow the mesh building process. Some are heavily used, some aren’t.</p> <p>There are several options that can be applied to each of the phase commands. These are the most common:</p> <table> <thead> <tr> <th>Command</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">G29 P1</code></td> <td>Phase 1 – Automatically probe the bed.</td> </tr> <tr> <td><code class="highlighter-rouge">G29 P2</code></td> <td>Phase 2 – Manually probe points that automated probing couldn’t reach.</td> </tr> <tr> <td><code class="highlighter-rouge">G29 P3</code></td> <td>Phase 3 – Assign values to points that still need values.</td> </tr> <tr> <td><code class="highlighter-rouge">G29 P4</code></td> <td>Phase 4 – Fine tune the mesh.</td> </tr> <tr> <td><code class="highlighter-rouge">G29 Snn</code></td> <td>Store the mesh in EEPROM slot <code class="highlighter-rouge">nn</code>.</td> </tr> <tr> <td> <code class="highlighter-rouge">G29 Lnn</code> or <code class="highlighter-rouge">M420 Lnn</code> </td> <td>Load a mesh from EEPROM slot <code class="highlighter-rouge">nn</code>. (Other leveling systems use <code class="highlighter-rouge">M501</code>.)</td> </tr> <tr> <td> <code class="highlighter-rouge">G29 A</code> or <code class="highlighter-rouge">M420 S1</code> </td> <td>Activate the Z compensation bed leveling.</td> </tr> <tr> <td> <code class="highlighter-rouge">G29 D</code> or <code class="highlighter-rouge">M420 S0</code> </td> <td>Disable the Z compensation bed leveling.</td> </tr> <tr> <td> <code class="highlighter-rouge">G29 T</code> or <code class="highlighter-rouge">M420 V</code> </td> <td>Print a map of the mesh.</td> </tr> <tr> <td><code class="highlighter-rouge">G26</code></td> <td>Print a pattern to test mesh accuracy.</td> </tr> <tr> <td><code class="highlighter-rouge">M421</code></td> <td>Touch up mesh points by specifying a value (<code class="highlighter-rouge">Z</code>) or offset (<code class="highlighter-rouge">Q</code>).</td> </tr> <tr> <td> <code class="highlighter-rouge">M502</code>, <code class="highlighter-rouge">M500</code> </td> <td>Reset settings to defaults, save to EEPROM.</td> </tr> </tbody> </table> <h3 id="automated-probing">Automated probing</h3> <p>The first step in the process is to use the Z probe to populate as much of the mesh as possible.</p> <p>To start the process issue <code class="highlighter-rouge">G29 P1</code> or, if you want to see the values as they are measured, <code class="highlighter-rouge">G29 P1 T</code></p> <p>If the EEPROM hasn’t been initialized then it’ll tell you to issue the <code class="highlighter-rouge">M502, M500, M501</code> sequence. If that happens then you’ll need to re-issue the <code class="highlighter-rouge">G29 P1</code> command.</p> <p>If a <code class="highlighter-rouge">G28</code> hasn’t already been done then the <code class="highlighter-rouge">G28</code> sequence will automatically be done followed by the<code class="highlighter-rouge"> G29 P1</code> probing.</p> <p>No further action is required of the user for this phase.</p> <p>If you do a <code class="highlighter-rouge">G29 T</code> or <code class="highlighter-rouge">M420 V</code> command you’ll most likely see areas that do not have Z compensation values. See the addendum <a href="#mesh-areas">Mesh area</a> for details.</p> <h3 id="manual-probing">Manual probing</h3> <p>This optional step uses the encoder wheel to move the nozzle up and down in 0.01mm steps. BE VERY CAREFUL when doing this. Nasty things can happen if too much force is applied to the bed by the nozzle.</p> <p>Most systems will have areas that the Z probe can’t reach. These points can be manually probed using <code class="highlighter-rouge">G29 P2</code>, but the ‘smart’ mesh filling of <code class="highlighter-rouge">G29 P3</code> is often good enough to make manual probing unnecessary.</p> <p>Manual probing consists of lowering the nozzle until the nozzle comes in contact with a feeler gauge. Usually the feeler gauge is a piece of paper or a business card. It’s better if the gauge is a piece of plastic that’s hard but still has some flex. Even better is a mechanic’s metal feeler gauge but those are usually too short to be convenient.</p> <p>The idea is to stop lowering when there is the first sign of resistance to moving the gauge. It is <em>very important</em> to be consistent in the amount of force/resistance from point to point.</p> <p>The first step is to measure the thickness of the feeler gauge:</p> <ul> <li> <p>Issue <code class="highlighter-rouge">G29 P2 B T</code> to start.</p> </li> <li> <p>The nozzle will move to the center of the bed.</p> </li> <li> <p>Use the encoder wheel to move the nozzle until you feel a small amount of resistance. This is the resistance level you’ll want to aim for when manually probing.</p> </li> <li> <p>Click the encoder button.</p> </li> <li> <p>Remove the feeler gauge.</p> </li> <li> <p>Lower the nozzle <strong>VERY SLOWLY</strong> until the nozzle just touches the bed.</p> </li> <li> <p>Click the encoder button.</p> </li> <li> <p>The nozzle will move to the first unmeasured location. Use the encoder to lower the nozzle until the desired resistance is felt with the feeler gauge. Click the encoder. The nozzle then moves to the next unmeasured location. Repeat until all locations are measured.</p> </li> <li> <p>See the host interface screen for the grid position you’re currently probing.</p> </li> </ul> <p>When done, you can use <code class="highlighter-rouge">G29 S</code> to save the mesh to EEPROM.</p> <h3 id="filling-in-the-mesh">Filling in the mesh</h3> <p>UBL includes a third phase, <code class="highlighter-rouge">G29 P3</code>, which fills in points on the mesh that were not probed automatically or manually. Note that unlike in bilinear leveling, UBL does not automatically extrapolate correction beyond the bounds of the mesh. If a mesh point is not defined no correction will be applied, and a missing point can affect up to 4 mesh cells.</p> <p>Issue <code class="highlighter-rouge">G29 P3</code> (no other parameters) to do a ‘smart fill’ of missing mesh points. This uses an extrapolation algorithm - which varies between delta and Cartesian systems - to give the unfilled mesh points reasonable initial values. You may need to run this more than once – each instance of <code class="highlighter-rouge">G29 P3</code> will fill in one missing line of the grid. This allows fine tuning between <code class="highlighter-rouge">P3</code> steps when filling the remainder of larger grids. From this point, <code class="highlighter-rouge">G26</code> and <code class="highlighter-rouge">G29 P4</code> can be used to iteratively refine the mesh.</p> <p><code class="highlighter-rouge">G29 P3 Cx.xx</code> can be used to manually fill a value into a mesh point(s), like <code class="highlighter-rouge">M421</code>, if for some reason that is necessary. <code class="highlighter-rouge">G29 P3 Cx.xx Rn</code> will fill the nearest n points with the value x.xx; ‘nearest’ is referenced to the nozzle position, unless X and Y arguments are provided to override the search start point.</p> <p>Again, <code class="highlighter-rouge">G29 S[n]</code> will save the mesh to EEPROM.</p> <h3 id="test-print">Test print</h3> <p>Once you have a reasonable looking mesh then it’s time to do a test print.</p> <p>The easiest way to do this is to use the <code class="highlighter-rouge">G26</code> command.</p> <p>There are several options for the <code class="highlighter-rouge">G26</code> command. See <a href="http://marlinfw.org/docs/gcode/G026.html">GCode G26</a> for details.</p> <p><code class="highlighter-rouge">G26 Bxx Hyy F1.75 L0.2 S0.4</code> will usually get you something reasonable:</p> <ul> <li> <code class="highlighter-rouge">Bxx</code> – bed temperature</li> <li> <code class="highlighter-rouge">Hyy</code> – hotend temperature</li> <li> <code class="highlighter-rouge">F1.75</code> – filament width of 1.75mm (default)</li> <li> <code class="highlighter-rouge">L0.2</code> – layer height of 0.2mm (default)</li> <li> <code class="highlighter-rouge">S0.4</code> – nozzle diameter of 0.4mm (default)</li> </ul> <h3 id="fine-tuning-of-the-matrix">Fine-tuning of the matrix</h3> <p>Look over the results of the <code class="highlighter-rouge">G26</code> print and note where adjustments are needed.</p> <p>To edit a single point move the nozzle close to the point that needs adjustment. Issue a <code class="highlighter-rouge">G29 P4 T</code>. The head will move to nearest point. Use the encoder wheel to change the value. If <code class="highlighter-rouge">UBL_MESH_EDIT_MOVES_Z</code> is enabled in <code class="highlighter-rouge">Configuration.h</code> (the default setting) the nozzle will change height during this process. If it is disabled the nozzle will not move.</p> <p>The values in the mesh indicate how far the nozzle needs to move along the Z axis to compensate for imperfections in the bed. Positive values mean that the nozzle needs to move <strong>away from</strong> the bed (“up”) and negative values mean that the nozzle needs to move <strong>towards</strong> the bed (“down”). Thus, if the <code class="highlighter-rouge">G26</code> print shows that for a specific mesh point the nozzle is too close to the bed (the lines are “squished” or the nozzle hit the bed when printing the test pattern) the value of the mesh point should be <strong>increased</strong>. If the nozzle is too far away from the bed (lines are too thin or not even sticking to the bed) the value of the mesh point should be <strong>decreased</strong>. This may cause the mesh point value to change from positive to negative or vice versa.</p> <p>For example, suppose that a mesh point has a probed value of -0.022 and the test pattern shows that the nozzle is too close at that point. If an adjustment of +0.050 is desired (moving the nozzle 0.050mm <strong>away from</strong> the bed) the new value for the mesh point would be +0.028.</p> <p>If <code class="highlighter-rouge">UBL_MESH_EDIT_MOVES_Z</code> is enabled it is also possible to use a piece of paper or a feeler gauge to adjust the position. Use a command of the form <code class="highlighter-rouge">G29 P4 Hxxx</code> where xxx is the thickness of the feeler gauge (or piece of paper) being used to adjust the nozzle height. For example <code class="highlighter-rouge">G29 P4 H0.1</code> is a good option to use with a piece of paper.</p> <p>To edit multiple points move the nozzle close to the first point and issue <code class="highlighter-rouge">G29 P4 T Rxx</code> where <code class="highlighter-rouge">xx</code> is the number of points you want to edit. You can look at the host interface screen to see where in the grid you are currently editing.</p> <p>Press and hold the encoder button/wheel when you are finished.</p> <p>There are options (<code class="highlighter-rouge">G29 P4 X... Y...</code>) to make it easier to move to the desired probe locations. For example <code class="highlighter-rouge">G29 P4 X110 Y110</code> will move to the grid point closest to the center of a 220x220mm bed.</p> <p>It’s probably a good idea to issue a <code class="highlighter-rouge">G29 S</code> command to save the mesh to EEPROM at this stage.</p> <p>Repeat the <code class="highlighter-rouge">G26</code>, <code class="highlighter-rouge">G29 P4 T</code> sequence until you have the desired first layer height quality.</p> <p>Issue a <code class="highlighter-rouge">G29 S</code> command periodically to save your mesh.</p> <p>As you print parts you may notice that further fine-tuning is needed. The <code class="highlighter-rouge">G29 P4 T</code> command can be used anytime to make adjustments.</p> <h2 id="addenda">Addenda</h2> <h3 id="ubl-without-an-lcd">UBL without an LCD</h3> <p>If you don’t have an LCD with encoder, or you have something like a MKS TFT that doesn’t behave like a proper display, then you will need to modify this process slightly.</p> <p>First, it is <strong>especially important</strong> that you physically level the bed as well as possible prior to initially probing the bed with <code class="highlighter-rouge">G29 P1</code>. This is always a prerequisite, but it is especially important here because without an LCD there’s no easy way to abort the probe process if the nozzle starts getting too close to the bed.</p> <p>Possible workarounds are to keep your finger on the reset button/power switch so you can quickly stop the probe process, or being ready to quickly issue <code class="highlighter-rouge">M112</code> (emergency stop) if <strong>and only if</strong> you have <code class="highlighter-rouge">EMERGENCY_PARSER</code> enabled in <code class="highlighter-rouge">Configuration_adv.h</code>.</p> <p>The same cautions apply to using the <code class="highlighter-rouge">G26</code> test print command; if something goes wrong you want a way to quickly abort the process before your print head is driven into the bed.</p> <p><code class="highlighter-rouge">G29 P2</code> (manual probe) is not available without a functional LCD, so instead of the sequence above users should skip directly from <code class="highlighter-rouge">G29 P1</code> (auto-probe) to <code class="highlighter-rouge">G29 P3</code> (smart fill). Likewise, <code class="highlighter-rouge">G29 P4 R...</code> cannot be used to interactively edit the mesh, so <code class="highlighter-rouge">M421</code> must be used instead to manually adjust individual mesh points. With UBL, the <code class="highlighter-rouge">M421 Q</code> form can be used to offset the specified mesh point, avoiding the need to specify absolute values.</p> <p>In summary, initial set-up without an LCD might look like this:</p> <pre><code class="language-gcode">G29 P1          ; Automatically probe accessible area
G29 P3          ; Fill un-probed areas with reasonable values - may need to be repeated
G26             ; Start test print / validation process
M421 ... Qx.xx  ; Direct edit mesh point, using offset
G29 S1          ; Save to slot 1, return to G26 for further refinement.
</code></pre> <h3 id="ubl-without-a-z-probe">UBL without a z-probe</h3> <p>UBL also includes the features previously provided by <code class="highlighter-rouge">MESH_BED_LEVELING</code> and <code class="highlighter-rouge">PROBE_MANUALLY</code>, allowing the user to take advantage of the system without having a z-probe at all. Again, the initialization and start-up process needs to be varied a bit.</p> <p>As in the case of no LCD, it is important to have good physical leveling of the bed before you start here - <strong>especially</strong> if you try to skip the manual probing step.</p> <p>In this case instead of starting with <code class="highlighter-rouge">G29 P1</code> to automatically probe the bed, you want to start with <code class="highlighter-rouge">G29 P0</code> to zero the mesh. From here you can go straight to the cycle of <code class="highlighter-rouge">G26...</code> to print a test pattern and <code class="highlighter-rouge">G29 P4 R...</code> to fine-tune mesh points - probably working your way ‘down’ from the worst area(s) of the validation pattern, and using <code class="highlighter-rouge">G29 S</code> to save results between iterations. You can also use <code class="highlighter-rouge">G29 P2</code> to manually probe first, which is recommended.</p> <p>If you use <code class="highlighter-rouge">G29 P2</code> to probe manually first, you probably want to <em>at least</em> probe the center and four corners of the bed – possibly some points in between as well. Then you want to use <code class="highlighter-rouge">G29 P3</code> commands to fill in reasonable initial values for the rest of the mesh before moving on to the <code class="highlighter-rouge">G26</code> / <code class="highlighter-rouge">G29 P4</code> cycle. <code class="highlighter-rouge">G29 P3 Rn Cx.xx</code> will fill in the nearest n grid points (to the nozzle) with the value specified by <code class="highlighter-rouge">Cx.xx</code>. You will probably have to use the <code class="highlighter-rouge">G29 P3 C...</code> form initially, rather than trying to let the smart fill algorithm handle lots of undefined points.</p> <p>So in summary, initial set-up of a mesh might look like this:</p> <pre><code class="language-gcode">G29 P0      ; Zero the mesh
; Optional
G29 P2...   ; Probe manually at appropriate locations
G29 P3...   ; Fill in missing points
; /Optional
G26         ; Jump into validation print / edit process
G29 P4 R... ; Refine mesh points
G29 S1      ; Save to slot 1, return to G26 for further refinement
</code></pre> <h3 id="bilinear-computation">Bilinear computation</h3> <ol> <li>Uses the Z heights at the 4 corners of the current XY position’s grid box.</li> <li>Performs a bilinear interpolation of the Z heights: <ul> <li>Calculates Z height (z1) at the left  edge of the box for the current Y by linear interpolation.</li> <li>Calculates Z height (z2) at the right edge of the box for the current Y by linear interpolation.</li> <li>Calculates Z height at the current X by linear interpolation between z1 and z2. This is the Z offset used for the move.</li> </ul> </li> </ol> <h3 id="mesh-areas">MESH areas</h3> <p>After <code class="highlighter-rouge">G29 P1</code> your matrix will probably have areas that do not have Z compensation values. This is because the probe can’t be positioned in these areas. The only ways to avoid this are:</p> <ul> <li>Use the nozzle as the probe (no offsets).</li> <li>Build your system so that the nozzle can travel outside the bed.</li> </ul> <p>If your probe is in front and to the right of your nozzle then the matrix will look like one of these.</p> <p><img src="/assets/images/features/bed_probe_areas.jpg" alt="image1"></p> <ul> <li>GREEN: Probing is possible</li> <li>BLUE: Probe can’t reach</li> </ul> <h3 id="further-optimization">Further Optimization</h3> <p>Going forward, we’ve been thinking anew about boundary-splitting and delta-style line-splitting. On kinematic systems, moves are split into small segments, so the nozzle already closely follows the (bilinear approx.) curve of the bed on those machines. Thus, on kinematic systems we can theoretically skip the boundary-splitting step.</p> <p>At the same time, we also realize that for mesh-based bed leveling, splitting up lines into smaller segments has extra benefit for Cartesians too. So, if we simply enable move-splitting for cartesians when mesh leveling is enabled, we can skip boundary-splitting while also improving leveling accuracy. Since it requires some extra computation, this ought to be an optional feature.</p> </div> </div> </div> </div> </div> <footer> <div class="container"> <div class="row"> <div class="col-lg-8"> <p>Brought to you with <i class="fa fa-heart text-danger" aria-hidden="true"></i> lack of <i class="fa fa-bed" aria-hidden="true"></i> and lots of <i class="fa fa-coffee" aria-hidden="true"></i>. <br> The contents of this website are © 2019 under the terms of the <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a> License.</p> </div> <div class="col-lg-4"> <div class="pull-right"> <a href="#top" data-proofer-ignore> Back to top <i class="fa fa-level-up" aria-hidden="true"></i></a> </div> </div> </div> </div> </footer> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76230130-1', {
          'cookieDomain': 'marlinfw.org',
          'siteSpeedSampleRate': 80
      });

      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script> </body> </html>