<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Linear Advance | Marlin Firmware</title> <meta property="og:title" content="Linear Advance"> <meta name="author" content="Sebastianv650, Sineos"> <meta property="og:locale" content="en_US"> <meta name="description" content="Nozzle pressure control to improve print quality"> <meta property="og:description" content="Nozzle pressure control to improve print quality"> <link rel="canonical" href="http://marlinfw.org/docs/features/lin_advance.html"> <meta property="og:url" content="http://marlinfw.org/docs/features/lin_advance.html"> <meta property="og:site_name" content="Marlin Firmware"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2018-10-16T12:31:30+01:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@MarlinFirmware"> <meta name="twitter:creator" content="@Sebastianv650, Sineos"> <script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Linear Advance","author":{"@type":"Person","name":"Sebastianv650, Sineos"},"datePublished":"2018-10-16T12:31:30+01:00","dateModified":"2018-10-16T12:31:30+01:00","description":"Nozzle pressure control to improve print quality","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://marlinfw.org/assets/images/logo/marlin/small.png"},"name":"Sebastianv650, Sineos"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://marlinfw.org/docs/features/lin_advance.html"},"url":"http://marlinfw.org/docs/features/lin_advance.html"}</script> <link rel="icon" href="/assets/favicon.ico"> <link rel="stylesheet" href="/assets/stylesheets/main.css"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script src="/assets/javascript/head.min.js"></script> <script type="text/javascript">
      /**
       * As Github pages do not support https for custom domains
       * this is the current best workaround for #18.
       */
      var domains  = ['marlinfw.org', 'localhost', '127.0.0.1' ];
      var pathname = location.pathname.replace(/^\/MarlinDocumentation/, '')
      if (domains.indexOf(window.location.hostname) == -1)
          window.top.location.href = 'http://marlinfw.org' + pathname;

      /**
       * Another ugly workaround trying to improve UX reported by #35
       */
       if (location.protocol != 'http:')
           location.href = 'http:' + window.location.href.substring(window.location.protocol.length);

      /**
       * Improves overall speed by loading javascript and css resources in parallel
       * with the main page.
       */
      head.load(
          "/assets/stylesheets/font-awesome.min.css",

          "/assets/javascript/jquery-2.2.1.min.js",
          "/assets/javascript/jquery-ui.min.js",
          "/assets/javascript/bootstrap.min.js",
          "/assets/javascript/tocify.min.js",
          "/assets/javascript/custom.js",

          "/assets/javascript/sheetrock.min.js",
          "/assets/javascript/cookieconsent.min.js"
      );

      head.ready(function() {
        window.cookieconsent_options = {
          "message":"We use cookies to ensure you get the best experience on our website",
          "dismiss": "Got it!", "learnMore": "More info", "link":"", "theme": "dark-bottom"
        };
      });
    </script> </head> <body role="document"> <nav class="navbar navbar-default navbar-fixed-top custom-no-margin"> <div class="container"> <div class="navbar-header"> <a href="/" class="navbar-brand"> <img src="/assets/images/logo/marlin/text-25.png" alt="Marlin"> </a> <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> </div> <div class="navbar-collapse collapse" id="navbar-main"> <ul class="nav navbar-nav"> <li><a href="/docs/basics/introduction.html">About Marlin</a></li> <li><a href="/meta/download/">Download</a></li> <li><a href="/docs/configuration/configuration.html">Configure</a></li> <li><a href="/docs/basics/install.html">Install</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-tools">Tools <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/tools/u8glib/converter.html">Bitmap Converter</a></li> <li><a href="/tools/lin_advance/k-factor.html">K-Factor Calibration Pattern</a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin/issues">Bugtracker</a></li> <li><a href="/docs/basics/reporting_bugs.html">Reporting bugs</a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin">Source Code Repository</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-documentation">Documentation <span class="caret"></span></a> <ul class="dropdown-menu"> <li class="dropdown-submenu configuration"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration</a> <ul class="dropdown-menu"> <li><a href="/meta/configuration/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/configuration/configuration.html"> Configuring Marlin 1.1 </a></li> <li><a href="/docs/configuration/laser_spindle.html"> Laser/Spindle Configuration </a></li> <li><a href="/docs/configuration/probes.html"> Probe Configuration </a></li> </ul> </li> <li class="dropdown-submenu development"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development</a> <ul class="dropdown-menu"> <li><a href="/meta/development/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/development/boards.html"> Boards </a></li> <li class="divider"> </li> <li><a href="/docs/development/coding_standards.html"> Coding Standards </a></li> <li><a href="/docs/development/getting_started_pull_requests.html"> Contributing Code with Pull Requests </a></li> <li><a href="/docs/development/git_scripts.html"> Marlin Github Scripts </a></li> <li class="divider"> </li> <li><a href="/docs/development/contributing.html"> Contributing to Marlin </a></li> <li><a href="/docs/development/feature_request.html"> Feature requests </a></li> <li class="divider"> </li> <li><a href="/docs/development/fonts.html"> Adding new fonts </a></li> <li><a href="/docs/development/lcd_language.html"> LCD Language System </a></li> </ul> </li> <li class="dropdown-submenu features"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features</a> <ul class="dropdown-menu"> <li><a href="/meta/features/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/features/auto_bed_leveling.html"> Automatic Bed Leveling </a></li> <li><a href="/docs/features/unified_bed_leveling.html"> Unified Bed Leveling </a></li> <li class="divider"> </li> <li><a href="/docs/features/fwretract.html"> Firmware Retract </a></li> <li><a href="/docs/features/lin_advance.html"> Linear Advance </a></li> <li><a href="/docs/features/tmc_drivers.html"> Trinamic drivers </a></li> <li class="divider"> </li> <li><a href="/docs/features/lcd_menu.html"> LCD Menu Tree </a></li> </ul> </li> <li class="dropdown-submenu gcode"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">G-code</a> <ul class="dropdown-menu"> <li><a href="/meta/gcode/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/gcode/G000-G001.html"> G0-G1: Linear Move </a></li> <li><a href="/docs/gcode/G002-G003.html"> G2-G3: Controlled Arc Move </a></li> <li><a href="/docs/gcode/G004.html"> G4: Dwell </a></li> <li><a href="/docs/gcode/G005.html"> G5: BÃ©zier cubic spline </a></li> <li><a href="/docs/gcode/G010.html"> G10: Retract </a></li> <li><a href="/docs/gcode/G011.html"> G11: Recover </a></li> <li><a href="/docs/gcode/G012.html"> G12: Clean the Nozzle </a></li> <li><a href="/docs/gcode/G020.html"> G20: Inch Units </a></li> <li><a href="/docs/gcode/G021.html"> G21: Millimeter Units </a></li> <li><a href="/docs/gcode/G026.html"> G26: Mesh Validation Pattern </a></li> <li><a href="/docs/gcode/G027.html"> G27: Park the nozzle </a></li> <li><a href="/docs/gcode/G028.html"> G28: Auto Home </a></li> <li><a href="/docs/gcode/G029-mbl.html"> G29: Mesh Bed Leveling </a></li> <li><a href="/docs/gcode/G029-abl.html"> G29: Automatic Bed Leveling </a></li> <li><a href="/docs/gcode/G029-ubl.html"> G29: Unified Bed Leveling </a></li> <li><a href="/docs/gcode/G030.html"> G30: Single Z-Probe </a></li> <li><a href="/docs/gcode/G031.html"> G31: Dock Sled </a></li> <li><a href="/docs/gcode/G032.html"> G32: Undock Sled </a></li> <li><a href="/docs/gcode/G033.html"> G33: Delta Auto Calibration </a></li> <li><a href="/docs/gcode/G038.html"> G38.2-G38.3: Probe target </a></li> <li><a href="/docs/gcode/G042.html"> G42: Move to mesh coordinate </a></li> <li><a href="/docs/gcode/G090.html"> G90: Absolute Positioning </a></li> <li><a href="/docs/gcode/G091.html"> G91: Relative Positioning </a></li> <li><a href="/docs/gcode/G092.html"> G92: Set Position </a></li> <li><a href="/docs/gcode/M000-M001.html"> M0-M1: Unconditional stop </a></li> <li><a href="/docs/gcode/M003.html"> M3: Spindle CW / Laser On </a></li> <li><a href="/docs/gcode/M004.html"> M4: Spindle CCW / Laser On </a></li> <li><a href="/docs/gcode/M005.html"> M5: Spindle / Laser Off </a></li> <li><a href="/docs/gcode/M017.html"> M17: Enable Steppers </a></li> <li><a href="/docs/gcode/M018.html"> M18-M84: Disable steppers </a></li> <li><a href="/docs/gcode/M020.html"> M20: List SD Card </a></li> <li><a href="/docs/gcode/M021.html"> M21: Init SD card </a></li> <li><a href="/docs/gcode/M022.html"> M22: Release SD card </a></li> <li><a href="/docs/gcode/M023.html"> M23: Select SD file </a></li> <li><a href="/docs/gcode/M024.html"> M24: Start or Resume SD print </a></li> <li><a href="/docs/gcode/M025.html"> M25: Pause SD print </a></li> <li><a href="/docs/gcode/M026.html"> M26: Set SD position </a></li> <li><a href="/docs/gcode/M027.html"> M27: Report SD print status </a></li> <li><a href="/docs/gcode/M028.html"> M28: Start SD write </a></li> <li><a href="/docs/gcode/M029.html"> M29: Stop SD write </a></li> <li><a href="/docs/gcode/M030.html"> M30: Delete SD file </a></li> <li><a href="/docs/gcode/M031.html"> M31: Print time </a></li> <li><a href="/docs/gcode/M032.html"> M32: Select and Start </a></li> <li><a href="/docs/gcode/M033.html"> M33: Get Long Path </a></li> <li><a href="/docs/gcode/M034.html"> M34: SDCard Sorting </a></li> <li><a href="/docs/gcode/M042.html"> M42: Set Pin State </a></li> <li><a href="/docs/gcode/M043.html"> M43: Debug Pins </a></li> <li><a href="/docs/gcode/M043-T.html"> M43 T: Toggle Details (Debug Pins) </a></li> <li><a href="/docs/gcode/M048.html"> M48: Probe Accuracy Test </a></li> <li><a href="/docs/gcode/M073.html"> M73: Set Print Progress </a></li> <li><a href="/docs/gcode/M075.html"> M75: Start Print Job </a></li> <li><a href="/docs/gcode/M076.html"> M76: Pause Print Job </a></li> <li><a href="/docs/gcode/M077.html"> M77: Stop Print Job </a></li> <li><a href="/docs/gcode/M078.html"> M78: Print Job Stats </a></li> <li><a href="/docs/gcode/M080.html"> M80: Power On </a></li> <li><a href="/docs/gcode/M081.html"> M81: Power Off </a></li> <li><a href="/docs/gcode/M082.html"> M82: E Absolute </a></li> <li><a href="/docs/gcode/M083.html"> M83: E Relative </a></li> <li><a href="/docs/gcode/M085.html"> M85: Inactivity Shutdown </a></li> <li><a href="/docs/gcode/M092.html"> M92: Set Axis Steps-per-unit </a></li> <li><a href="/docs/gcode/M100.html"> M100: Free Memory </a></li> <li><a href="/docs/gcode/M104.html"> M104: Set Hotend Temperature </a></li> <li><a href="/docs/gcode/M105.html"> M105: Report Temperatures </a></li> <li><a href="/docs/gcode/M106.html"> M106: Set Fan Speed </a></li> <li><a href="/docs/gcode/M107.html"> M107: Fan Off </a></li> <li><a href="/docs/gcode/M108.html"> M108: Break and Continue </a></li> <li><a href="/docs/gcode/M109.html"> M109: Wait for Hotend Temperature </a></li> <li><a href="/docs/gcode/M110.html"> M110: Set Line Number </a></li> <li><a href="/docs/gcode/M111.html"> M111: Debug Level </a></li> <li><a href="/docs/gcode/M112.html"> M112: Emergency Stop </a></li> <li><a href="/docs/gcode/M113.html"> M113: Host Keepalive </a></li> <li><a href="/docs/gcode/M114.html"> M114: Get Current Position </a></li> <li><a href="/docs/gcode/M115.html"> M115: Firmware Info </a></li> <li><a href="/docs/gcode/M117.html"> M117: Set LCD Message </a></li> <li><a href="/docs/gcode/M118.html"> M118: Serial print </a></li> <li><a href="/docs/gcode/M119.html"> M119: Endstop States </a></li> <li><a href="/docs/gcode/M120.html"> M120: Enable Endstops </a></li> <li><a href="/docs/gcode/M121.html"> M121: Disable Endstops </a></li> <li><a href="/docs/gcode/M122.html"> M122: TMC Debugging </a></li> <li><a href="/docs/gcode/M125.html"> M125: Park Head </a></li> <li><a href="/docs/gcode/M126.html"> M126: Baricuda 1 Open </a></li> <li><a href="/docs/gcode/M127.html"> M127: Baricuda 1 Close </a></li> <li><a href="/docs/gcode/M128.html"> M128: Baricuda 2 Open </a></li> <li><a href="/docs/gcode/M129.html"> M129: Baricuda 2 Close </a></li> <li><a href="/docs/gcode/M140.html"> M140: Set Bed Temperature </a></li> <li><a href="/docs/gcode/M145.html"> M145: Set Material Preset </a></li> <li><a href="/docs/gcode/M149.html"> M149: Set Temperature Units </a></li> <li><a href="/docs/gcode/M150.html"> M150: Set RGB(W) Color </a></li> <li><a href="/docs/gcode/M155.html"> M155: Temperature Auto-Report </a></li> <li><a href="/docs/gcode/M163.html"> M163: Set Mix Factor </a></li> <li><a href="/docs/gcode/M164.html"> M164: Save Mix </a></li> <li><a href="/docs/gcode/M165.html"> M165: Set Mix </a></li> <li><a href="/docs/gcode/M190.html"> M190: Wait for Bed Temperature </a></li> <li><a href="/docs/gcode/M200.html"> M200: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M201.html"> M201: Set Print Max Acceleration </a></li> <li><a href="/docs/gcode/M203.html"> M203: Set Max Feedrate </a></li> <li><a href="/docs/gcode/M204.html"> M204: Set Starting Acceleration </a></li> <li><a href="/docs/gcode/M205.html"> M205: Set Advanced Settings </a></li> <li><a href="/docs/gcode/M206.html"> M206: Set Home Offsets </a></li> <li><a href="/docs/gcode/M207.html"> M207: Set Firmware Retraction </a></li> <li><a href="/docs/gcode/M208.html"> M208: Set Firmware Recovery </a></li> <li><a href="/docs/gcode/M209.html"> M209: Set Auto Retract </a></li> <li><a href="/docs/gcode/M211.html"> M211: Software Endstops </a></li> <li><a href="/docs/gcode/M217.html"> M217: Filament swap parameters </a></li> <li><a href="/docs/gcode/M218.html"> M218: Set Hotend Offset </a></li> <li><a href="/docs/gcode/M220.html"> M220: Set Feedrate Percentage </a></li> <li><a href="/docs/gcode/M221.html"> M221: Set Flow Percentage </a></li> <li><a href="/docs/gcode/M226.html"> M226: Wait for Pin State </a></li> <li><a href="/docs/gcode/M240.html"> M240: Trigger Camera </a></li> <li><a href="/docs/gcode/M250.html"> M250: LCD Contrast </a></li> <li><a href="/docs/gcode/M260.html"> M260: I2C Send </a></li> <li><a href="/docs/gcode/M261.html"> M261: I2C Request </a></li> <li><a href="/docs/gcode/M280.html"> M280: Servo Position </a></li> <li><a href="/docs/gcode/M290.html"> M290: Babystep </a></li> <li><a href="/docs/gcode/M300.html"> M300: Play Tone </a></li> <li><a href="/docs/gcode/M301.html"> M301: Set Hotend PID </a></li> <li><a href="/docs/gcode/M302.html"> M302: Cold Extrude </a></li> <li><a href="/docs/gcode/M303.html"> M303: PID autotune </a></li> <li><a href="/docs/gcode/M304.html"> M304: Set Bed PID </a></li> <li><a href="/docs/gcode/M350.html"> M350: Set micro-stepping </a></li> <li><a href="/docs/gcode/M351.html"> M351: Set Microstep Pins </a></li> <li><a href="/docs/gcode/M355.html"> M355: Case Light Control </a></li> <li><a href="/docs/gcode/M360.html"> M360: SCARA Theta A </a></li> <li><a href="/docs/gcode/M361.html"> M361: SCARA Theta-B </a></li> <li><a href="/docs/gcode/M362.html"> M362: SCARA Psi-A </a></li> <li><a href="/docs/gcode/M363.html"> M363: SCARA Psi-B </a></li> <li><a href="/docs/gcode/M364.html"> M364: SCARA Psi-C </a></li> <li><a href="/docs/gcode/M380.html"> M380: Activate Solenoid </a></li> <li><a href="/docs/gcode/M381.html"> M381: Deactivate Solenoids </a></li> <li><a href="/docs/gcode/M400.html"> M400: Finish Moves </a></li> <li><a href="/docs/gcode/M401.html"> M401: Deploy Probe </a></li> <li><a href="/docs/gcode/M402.html"> M402: Stow Probe </a></li> <li><a href="/docs/gcode/M404.html"> M404: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M405.html"> M405: Filament Width Sensor On </a></li> <li><a href="/docs/gcode/M406.html"> M406: Filament Width Sensor Off </a></li> <li><a href="/docs/gcode/M407.html"> M407: Filament Width </a></li> <li><a href="/docs/gcode/M410.html"> M410: Quickstop </a></li> <li><a href="/docs/gcode/M420.html"> M420: Bed Leveling State </a></li> <li><a href="/docs/gcode/M421.html"> M421: Set Mesh Value </a></li> <li><a href="/docs/gcode/M428.html"> M428: Home Offsets Here </a></li> <li><a href="/docs/gcode/M500.html"> M500: Save Settings </a></li> <li><a href="/docs/gcode/M501.html"> M501: Restore Settings </a></li> <li><a href="/docs/gcode/M502.html"> M502: Factory Reset </a></li> <li><a href="/docs/gcode/M503.html"> M503: Report Settings </a></li> <li><a href="/docs/gcode/M504.html"> M504: Validate EEPROM contents </a></li> <li><a href="/docs/gcode/M540.html"> M540: Endstops Abort SD </a></li> <li><a href="/docs/gcode/M600.html"> M600: Filament Change </a></li> <li><a href="/docs/gcode/M603.html"> M603: Configure Filament Change </a></li> <li><a href="/docs/gcode/M605.html"> M605: Dual Nozzle Mode </a></li> <li><a href="/docs/gcode/M665.html"> M665: Delta Configuration </a></li> <li><a href="/docs/gcode/M665-scara.html"> M665: SCARA Configuration </a></li> <li><a href="/docs/gcode/M666.html"> M666: Set Delta endstop adjustments </a></li> <li><a href="/docs/gcode/M666-dual.html"> M666: Set dual endstop offsets </a></li> <li><a href="/docs/gcode/M851.html"> M851: Z Probe Offset </a></li> <li><a href="/docs/gcode/M852.html"> M852: Bed Skew Compensation </a></li> <li><a href="/docs/gcode/M900.html"> M900: Linear Advance Factor </a></li> <li><a href="/docs/gcode/M906.html"> M906: TMC Motor Current </a></li> <li><a href="/docs/gcode/M907.html"> M907: Set Motor Current </a></li> <li><a href="/docs/gcode/M908.html"> M908: Set Trimpot Pins </a></li> <li><a href="/docs/gcode/M909.html"> M909: DAC Print Values </a></li> <li><a href="/docs/gcode/M910.html"> M910: Commit DAC to EEPROM </a></li> <li><a href="/docs/gcode/M911.html"> M911: TMC OT Pre-Warn Condition </a></li> <li><a href="/docs/gcode/M912.html"> M912: Clear TMC OT Pre-Warn </a></li> <li><a href="/docs/gcode/M913.html"> M913: Set Hybrid Threshold Speed </a></li> <li><a href="/docs/gcode/M914.html"> M914: TMC Bump Sensitivity </a></li> <li><a href="/docs/gcode/M915.html"> M915: TMC Z axis calibration </a></li> <li><a href="/docs/gcode/M928.html"> M928: Start SD Logging </a></li> <li><a href="/docs/gcode/M999.html"> M999: STOP Restart </a></li> </ul> </li> <li class="dropdown-submenu hardware"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware</a> <ul class="dropdown-menu"> <li><a href="/meta/hardware/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/hardware/boards.html"> Boards </a></li> <li><a href="/docs/hardware/endstops.html"> Endstops </a></li> <li><a href="/docs/hardware/tmc_drivers.html"> Trinamic drivers </a></li> </ul> </li> <li class="divider"> </li> <li><a href="/meta/needs-review/">Documentation Needing Review</a></li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right visible-lg-block"> <li><a href="https://github.com/MarlinFirmware/MarlinDocumentation/edit/master/_features/lin_advance.md" data-proofer-ignore> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Improve this page</span> </a></li> </ul> </div> </div> </nav> <div class="container" role="main"> <div class="row"> <div class="col-lg-3 col-md-4 visible-lg-block visible-md-block custom-no-padding"> <div class="custom-fixed-sidebar"> <div id="toc"></div> </div> </div> <div class="col-lg-9 col-md-8 custom-bg-white"> <div class="row"> <div class="col-md-12 custom-article"> <p class="text-right pull-right visible-lg-block hidden-print small custom-pt25"> <a href="https://github.com/Sebastianv650" data-toggle="tooltip" data-placement="bottom" title="Visit Sebastianv650's profile on Github"><img class="avatar avatar-small" src="https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=30" alt="Sebastianv650" srcset="https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=30 1x, https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=60 2x, https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=90 3x, https://avatars1.githubusercontent.com/Sebastianv650?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> <a href="https://github.com/Sineos" data-toggle="tooltip" data-placement="bottom" title="Visit Sineos's profile on Github"><img class="avatar avatar-small" src="https://avatars2.githubusercontent.com/Sineos?v=3&amp;s=30" alt="Sineos" srcset="https://avatars2.githubusercontent.com/Sineos?v=3&amp;s=30 1x, https://avatars2.githubusercontent.com/Sineos?v=3&amp;s=60 2x, https://avatars2.githubusercontent.com/Sineos?v=3&amp;s=90 3x, https://avatars2.githubusercontent.com/Sineos?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> </p> <h1 class="custom-article-header">Linear Advance</h1> <hr> <h2 id="background">Background</h2> <p>Under default conditions, extruder axis movement is treated in the same way as the XYZ linear axes. The extruder motor moves in linear proportion to all the other motors, maintaining exactly the same acceleration profile and start/stop points. But an extruder is not a linear system, so this approach leads, most obviously, to extra material being extruded at the end of each linear movement.</p> <p>Take the common test-cube as an example. Even with the best tuning the corners are usually not sharp, but bleed out. The top solid infill displays roughness where the print direction changes on perimeters. These problems are minor or even imperceptible at low printing speeds, but they become more noticeable and problematic as print speeds increase.</p> <p>Tuning the flow can help, but this may lead to under-extrusion when starting new lines. Some slicers include an option to end extrusion early in each move, but this adds more complexity to the G-code and has to be retuned for different temperatures and materials.</p> <p>Since the root cause is pressure, <code class="highlighter-rouge">LIN_ADVANCE</code> de-couples extrusion from the other axes to produce the correct pressure inside the nozzle, adapting to the printing speed. Once Linear Advance is properly tuned, bleeding edges and rough solid infill should be nearly eliminated. <br></p> <h2 id="advantages">Advantages</h2> <ul> <li>Better dimensional precision due to reduced bleeding edges.</li> <li>Higher printing speeds are possible without any loss of print quality - as long as your extruder can handle the needed speed changes.</li> <li>Visible and tangible print quality is increased even at lower printing speeds.</li> <li>No need for high acceleration and jerk values to get sharp edges.</li> </ul> <p><br></p> <h2 id="special-notes-for-v15">Special notes for v1.5</h2> <h3 id="changelog">Changelog</h3> <ul> <li>K is now a meaningful value with the unit [mm of filament compression needed per 1mm/s extrusion speed] or [mm/mm/s].</li> <li>Load inside stepper ISR reduced as no calculations are needed there any more. Instead, the extruder runs at a fixed speed offset during pressure adjustment. Therefore this version runs faster.</li> <li>LIN_ADVANCE now respects hardware limitations set in Configuration.h, namely extruder jerk. If the pressure corrections require faster adjustments than allowed by extruder jerk limit, the acceleration for this print move is limited to a value which allows to use extruder jerk speed as the upper limit.</li> <li>The pressure adjustment moves donât lead to a rattling extruder as it was in v1.0: as the extruder is now running at a smooth speed instead of jerking between multiples of extruder print speed.</li> <li>This smooth extruder operation and respecting of jerk limits ensures no extruder steps are skipped.</li> </ul> <h3 id="new-k-value-required">New K value required</h3> <p>As the unit of K has changed, you have to redo the K calibration procedure. See next chapter for details. While old v1 K values for PLA might be between 30-130, you can now expect K to be around 0.1-2.0.</p> <h3 id="lin_advance-can-reduce-your-print-acceleration">LIN_ADVANCE can reduce your print acceleration</h3> <p>In v1, if K was set to a high value which couldnât be handled by your printer, then the printer was losing steps and/or using all of itâs processing power to execute extruder steps. In v1.5, this is handled much smarter. <code class="highlighter-rouge">LIN_ADVANCE</code> will now check if it can execute the advance steps as needed. If the needed extruder speed exceeds the extruder jerk limit, it will reduce the print acceleration for the line printed to a value which keeps the extruder speed within the limit.</p> <p>While you will most likely not run into this on direct drive printers with filaments like PLA, it will happen most likely on bowden printers as they need higher K values and therefore faster speed adaptions. If this happens to an amount you donât want to accept, you have the following options:</p> <ul> <li>Check your extruder jerk setting. If you have the feeling it is set to a very conservative value, try increasing it.</li> <li>Keep the extruder acceleration low. This can be achieved by lowering the layer height or line width for example</li> <li>Keep K as low as possible. Maybe you can shorten the bowden tube?</li> </ul> <h3 id="a-note-on-bowden-printers-vs-lin_advance">A note on bowden printers vs. LIN_ADVANCE</h3> <p>A quite common note during development of <code class="highlighter-rouge">LIN_ADVANCE</code> was that bowden systems (and especially delta printers) are meant to be faster due to the lower moving mass. So lowering the print acceleration as described above would be an inadequate solution. On the other hand, bowden systems need a pressure advance feature the most as they usually have the most problems with speed changes.</p> <p>Well, <code class="highlighter-rouge">LIN_ADVANCE</code> was developed because I (Sebastianv650) wasnât satisfied by the print quality I got out of my direct drive printer. While itâs a possible point of view to say that lowering acceleration on a bowden printer (which is meant to be fast) is a bad thing, I see it differently: if you would be satisfied with the print quality your bowden setup gives you, you wouldnât be reading about a way to do pressure corrections, isnât it? So maybe in this case the highest possible top speed is quite useless.. Bowdens are an option to keep moving mass low and therefore allowing higher movement speeds, but donât expect them to give the same precise filament laydown ability than a direct drive one. Itâs like painting a picture: try to paint with a 1m long brush, grabing the rear end of the handle which is made from rubber. Even if you try to compensate for the wobbly brush tip (which is basically what <code class="highlighter-rouge">LIN_ADVANCE</code> does), it will never be as good as using a usual brush. On the other hand, if you only need to have a part printed fast without special needs in terms of quality, there is no reason to enable <code class="highlighter-rouge">LIN_ADVANCE</code> at all. For those prints, you can just set K to 0.</p> <h2 id="calibration">Calibration</h2> <h3 id="generate-test-pattern">Generate Test Pattern</h3> <p>Marlin documentation provides a <a href="/tools/lin_advance/k-factor.html">K-Factor Calibration Pattern generator</a>. This script will generate a G-code file that supports determining a proper K-Factor value. The generated G-code will print a test pattern as shown in the following illustration:</p> <p><img src="/assets/images/features/lin_advance/k-factor_basics.png" alt="basics"></p> <p>Beginning with the chosen <code class="highlighter-rouge">Start value for K</code>, individual lines will be printed from left to right. Each line consists of 20 mm extrusion using <code class="highlighter-rouge">Slow Printing Speed</code> being followed by 40 mm of <code class="highlighter-rouge">Fast Printing Speed</code> and finally being concluded by another 20 mm of <code class="highlighter-rouge">Slow Printing Speed</code>.</p> <p>For each new line the K-Factor will be increased by the <code class="highlighter-rouge">K-Factor Stepping</code> value, up to the provided <code class="highlighter-rouge">End Value for K</code>.</p> <p><br></p> <h4 id="general-considerations-for-the-test-pattern-settings">General considerations for the Test Pattern Settings</h4> <ul> <li> <a href="http://reprap.org/wiki/Erik%27s_Bowden_Extruder">Bowden</a> extruders need a higher K-Factor than direct extruders. Consider a <code class="highlighter-rouge">Start value for K</code> of around 0.1 up to an <code class="highlighter-rouge">End Value for K</code> of around 2.0 for LIN_ADVANCE v1.5 or around 30 up to an <code class="highlighter-rouge">End Value for K</code> of around 130 for v1.0.</li> <li>The best matching K-Factor to be used in production depends on. <ul> <li>Type of filament. Extremely flexible filaments like Ninjaflex may not work at all.</li> <li>Printing temperature.</li> <li>Extruder characteristics: Bowden vs. direct extruder , bowden length, free filament length in the extruder, etc.</li> <li>Nozzle size and geometry.</li> </ul> </li> <li>The extruderâs steps/mm value has to be <a href="http://reprap.org/wiki/Triffid_Hunter%27s_Calibration_Guide#E_steps">calibrated precisely</a>. Calibration is recommended at low speeds to avoid additional influences.</li> <li>Minimize Backlash caused by gears <a href="http://reprap.org/wiki/Wade%27s_Geared_Extruder">geared extruder</a> or by push fittings. As it will not influence the K-Factor, it can lead to strange noises from the extruder due to the pressure control.</li> </ul> <blockquote> <p>Repeat the calibration, if any of the above parameters change.</p> </blockquote> <p><br></p> <h3 id="evaluating-the-calibration-pattern">Evaluating the Calibration Pattern</h3> <p>The transition between <code class="highlighter-rouge">Slow Printing Speed</code> phases and <code class="highlighter-rouge">Fast Printing Speed</code> phases are the points of interest to determine the best matching K-Factor. Following illustration shows a magnified view of a line where the K-Factor is too low:</p> <p><img src="/assets/images/features/lin_advance/k-factor_low.png" alt="low"></p> <table> <thead> <tr> <th style="text-align: center">Phase</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">1</td> <td><code class="highlighter-rouge">Slow Printing Speed</code></td> </tr> <tr> <td style="text-align: center">2</td> <td>Beginning of the <code class="highlighter-rouge">Fast Printing Speed</code>. The pressure build up in the nozzle (= amount of extruded material) is lagging behind the acceleration of the print-head. This results in too little material and a starved line. Towards the end of this phase, the pressure is catching up to its intended value.</td> </tr> <tr> <td style="text-align: center">3</td> <td>Extrusion and print-head movement are in sync. The nominal line width is extruded</td> </tr> <tr> <td style="text-align: center">4</td> <td>Beginning of the deceleration towards <code class="highlighter-rouge">Slow Printing Speed</code>. Here the opposite of Phase 2 can be observed: The pressure decrease in the nozzle is lagging behind the deceleration of the print-head. This results in too much material being extruded</td> </tr> <tr> <td style="text-align: center">5</td> <td>Beginning of the <code class="highlighter-rouge">Slow Printing Speed</code> phase. Still the pressure in the nozzle is not in sync with the intended extrusion amount and the line is suffering from over-extrusion.</td> </tr> <tr> <td style="text-align: center">6</td> <td> <code class="highlighter-rouge">Slow Printing Speed</code> has stabilized.</td> </tr> </tbody> </table> <p>A too high K-Factor essentially reverses the above picture. The extruded amount will overshoot at the start of an acceleration and starve in the deceleration phase. <br></p> <blockquote> <p>The test line, which has a fluid and barely visible or even invisible transition between the different speed phases represents the best matching K-Factor.</p> </blockquote> <p><br></p> <h2 id="setting-the-k-factor-for-production">Setting the K-Factor for production</h2> <h3 id="considerations-before-using-linear-advance">Considerations before using Linear Advance</h3> <ul> <li>Some slicers have options to control the nozzle pressure. Common names are: <em>Pressure advance</em>, <em>Coast at end</em>, <em>extra restart length after retract</em>. Disable these options as they will interfere with Linear Advance.</li> <li>Also disable options like <em>wipe while retract</em> or <em>combing</em>. There should be almost no ooze, once the proper K-Factor is found.</li> <li>Recheck retraction distance, once Linear Advance is calibrated and working well. It may even be as low as 0, since pressure control reduces the material pressure at the end of a line to nearly zero.</li> </ul> <h3 id="the-following-considerations-are-no-longer-a-problem-with-lin_advance-version-15">The following considerations are no longer a problem with LIN_ADVANCE version 1.5</h3> <ul> <li>This feature adds extra load to the CPU (and possibly more wear on the extruder). Using a communication speed of 115200 baud or lower to prevent communication errors and âweirdâ movements is recommended.</li> <li>The print host software should be using line numbers and checksums. (This is disabled by default e.g. in Simplify3D)</li> <li>Theoretically there should be no âextraâ movements produced by <code class="highlighter-rouge">LIN_ADVANCE</code>. If extra movements were produced, this would tend to increase wear on more fragile parts such as the printed gears of a Wade extruder.</li> </ul> <h3 id="saving-the-k-factor-in-the-firmware">Saving the K-Factor in the Firmware</h3> <p>If only one filament material is used, the best way is to set the K-Factor inside <code class="highlighter-rouge">Configuration_adv.h</code> and reflash the firmware:</p> <div class="highlighter-rouge"> <pre class="highlight"><code>/**
* Implementation of linear pressure control
*
* Assumption: advance = k * (delta velocity)
* K=0 means advance disabled.
* See Marlin documentation for calibration instructions.
*/
#define LIN_ADVANCE

#if ENABLED(LIN_ADVANCE)
#define LIN_ADVANCE_K &lt;your_value_here&gt;
</code></pre> </div> <h3 id="adding-the-k-factor-to-the-g-code-start-script">Adding the K-Factor to the G-code Start Script</h3> <p><a href="http://reprap.org/wiki/Start_GCode_routines">G-code Start Scripts</a> are supported by various slicers. The big advantage of setting the K-Factor via this methods is that it can easily be modified, e.g. when switching to a different material. The K-Factor is defined by adding the command <code class="highlighter-rouge">M900 Kxx</code> to the end of the start script, where <em>xx</em> is the value determined with the above test pattern.</p> <p>The following chapter briefly describes where to find the relevant setting in popular slicers.</p> <p><strong>Note 1:</strong></p> <p>With the G-code Start Script method, the feature still needs to be activated in the firmware as described in <a href="#saving-the-k-factor-in-the-firmware">Saving the K-Factor in the Firmware</a>. It is recommended to set <code class="highlighter-rouge">#define LIN_ADVANCE_K</code> to 0, which effectively disables the hard-coded firmware value. In this case only the K-Factor set via the start script is used.</p> <p><strong>Note 2:</strong></p> <p>The shown G-code Start Scripts are individual to each printer and personal taste. This is only intended to demonstrate where the K-Factor setting can be applied.</p> <p><br></p> <h4 id="cura">Cura</h4> <p><em>Settings</em> â&gt; <em>Printer</em> â&gt; <em>Manage Printer</em> â&gt; <em>Machine Settings</em></p> <p><img src="/assets/images/features/lin_advance/cura.png" alt="cura"> <br><br><br></p> <h4 id="slic3r">Slic3r</h4> <p><em>Settings</em> â&gt; <em>Printer Settings</em> â&gt; <em>Custom G-code</em></p> <p><img src="/assets/images/features/lin_advance/slic3r.png" alt="slic3r"> <br><br><br></p> <h4 id="simplify-3d">Simplify 3D</h4> <p><em>Edit Process Settings</em> â&gt; <em>Show Advanced</em> â&gt; <em>Scripts</em> â&gt; <em>Custom G-code</em></p> <p><img src="/assets/images/features/lin_advance/s3d.png" alt="s3d"> <br><br></p> <h2 id="developer-information">Developer Information</h2> <h3 id="general-informations">General Informations</h3> <p>The force required to push the filament through the nozzle aperture depends, in part, on the speed at which the material is being pushed into the nozzle. If the material is pushed faster (=printing fast), the filament needs to be compressed more before the pressure inside the nozzle is high enough to start extruding the material.</p> <p>For a single, fast printed line, this results in under-extrusion at the lineâs starting point (the filament gets compressed, but the pressure isnât high enough) and over-extrusion with a blob at the end of the line (the filament is still compressed when the E motor stops, resulting in oozing).</p> <p>For a complete print, this leads to bleeding edges at corners (corners are stop/end points of lines) and in extreme cases even gaps between perimeters due to under-extrusion at their starting points.</p> <h3 id="version-15">Version 1.5</h3> <p>Version 1.5 handles the pressure correction in a slightly different way to reach the following goals:</p> <ul> <li>respect extruder jerk</li> <li>ensure a smooth extruder movement without rattling</li> <li>reduce load inside stepper ISR</li> </ul> <p>It does this by calculating an extruder speed offset within the planner for the given segment. If we have a true, linear acceleration then this will execute the needed advance steps just in time, so we have reached all our needed advance steps just when the acceleration part is over. As Marlin uses an approximation for the acceleration calculation inside the ISR, this is not perfectly true, we will come to this later. If the needed speed offset exceeds the allowed extruder jerk, the print acceleration for this segment is reduced to a lower value so extruder jerk is not exceeded any more. This is comparable to the check Marlin does for each axis, for example if we have a print acceleration of 2000mm/sÂ² but X axis max. acceleration is set to 500mm/sÂ², print acceleration is reduced to 500mm/sÂ². During the trapezoid calculation, <code class="highlighter-rouge">LIN_ADVANCE</code> calculates the needed amount of advance steps at cruising speed and at final speed (=speed at and of the block).</p> <p>When this block is executed by the stepper ISR, the extruder is set to a frequency which represents the calculated speed offset. The advance step is executed together with normal e steps. During the block runtime, the pressure will be advanced until the precalculated needed extra step amount is reached or the deceleration is started. During deceleration we reduce the advance step amount until we reach the amount for final speed or the block comes to an end. This checks are necessary as Marlin uses an approximation for acceleration calculation as mentioned above. Therefore, for example, we might not reach the final pressure at end of move perfectly but thatâs not important as this error will not cumulate.</p> <p>The next update might include improved handling of variable width moves. On variable width path itâs possible that we need to deplete pressure during acceleration, for example when the next line is much narrower than the previous one. Therefore <code class="highlighter-rouge">LIN_ADVANCE</code> would need to check for the actual extruder direction needed. Another case to be considered is the gap fill to the tip of a triangle: in this case Marlin will move on with a constant speed, but the extruder speed and therefore needed pressure gets smaller and smaller when we approach the tip of the triangle. We should adapt nozzle pressure with max. possible speed (extruder jerk speed) then. As gap fill is done at quite low speeds by most slicers, we have to decide if that extra load is worth the effect. On 32bit boards where calculation performance is most likely not a problem, it makes sense in any case.</p> <h3 id="version-10">Version 1.0</h3> <p>The <code class="highlighter-rouge">LIN_ADVANCE</code> pressure control handles this free filament length as a spring, where <code class="highlighter-rouge">K</code> is a spring constant. When the nozzle starts to print a line, it takes the extrusion speed as a reference. Additional to the needed extrusion length for a line segment, which is defined by the slicer, it calculates the needed extra compression of the filament to reach the needed nozzle pressure so that the extrusion length defined by the slicer is really extruded. This is done in every loop of the stepper ISR.</p> <p>During deceleration, the filament compression is released again by the same formula: <code class="highlighter-rouge">advance_steps = delta_extrusion_speed * K</code>. During deceleration, <code class="highlighter-rouge">delta_extrusion_speed</code> is negative, thus the <code class="highlighter-rouge">advance_steps</code> values is negative which leads to a <strong>retract</strong> (or slowed) movement, relaxing the filament again.</p> <p>The basic formula (<code class="highlighter-rouge">advance_steps = delta_extrusion_speed * K</code>) is the same as in the famous JKN pressure control, but with one important difference: JKN calculates the sum of all required advance extruder steps inside the planner loop and distributes them equally over every acceleration and deceleration stepper ISR loop. This leads to the wrong distribution of advance steps, resulting in an imperfect print result. <code class="highlighter-rouge">LIN_ADVANCE</code> calculates the extra steps on the fly in <em>every</em> stepper ISR loop, therefore applying the required steps precisely where needed.</p> <p>For further details and graphs have a look into <a href="https://drive.google.com/file/d/0B5UvosQgK3adaHVtdUI5OFR3VUU/view">this presentation, slides 7-9</a>.</p> <p>In Marlin, all the work is done in the <code class="highlighter-rouge">stepper.*</code> and <code class="highlighter-rouge">planner.*</code> files. In the planner loop, <code class="highlighter-rouge">LIN_ADVANCE</code> checks whether a move needs pressure control. This applies only to print moves, not to travel moves and extruder-only moves (like retract and prime).</p> <p>In the <code class="highlighter-rouge">Stepper::isr</code> method, <code class="highlighter-rouge">LIN_ADVANCE</code> calculates the number of extra steps needed to reach the required nozzle pressure. To avoid missing steps, it doesnât execute them all at once, but distributes them over future calls to the interrupt service routine.</p> <p>In v1.0 there is no check if the extruder acceleration, speed or jerk will exceed the limits set inside Configuration.h!</p> </div> </div> </div> </div> </div> <footer> <div class="container"> <div class="row"> <div class="col-lg-12"> <hr> </div> </div> <div class="row"> <div class="col-lg-8"> <p>Brought to you with <i class="fa fa-heart text-danger" aria-hidden="true"></i> lack of <i class="fa fa-bed" aria-hidden="true"></i> and lots of <i class="fa fa-coffee" aria-hidden="true"></i>. <br> The contents of this website are Â© 2018 under the terms of the <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a> License.</p> </div> <div class="col-lg-4"> <div class="pull-right"> <a href="#top" data-proofer-ignore> Back to top <i class="fa fa-level-up" aria-hidden="true"></i></a> </div> </div> </div> </div> </footer> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76230130-1', {
          'cookieDomain': 'marlinfw.org',
          'siteSpeedSampleRate': 80
      });

      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script> </body> </html>