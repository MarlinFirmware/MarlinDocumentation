<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Coding Standards | Marlin Firmware</title> <meta property="og:title" content="Coding Standards"> <meta name="author" content="thinkyhead"> <meta property="og:locale" content="en_US"> <meta name="description" content="Guidelines for Marlin code formatting, methodologies, and standards."> <meta property="og:description" content="Guidelines for Marlin code formatting, methodologies, and standards."> <link rel="canonical" href="http://marlinfw.org/docs/development/coding_standards.html"> <meta property="og:url" content="http://marlinfw.org/docs/development/coding_standards.html"> <meta property="og:site_name" content="Marlin Firmware"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2018-10-31T03:43:26+00:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@MarlinFirmware"> <meta name="twitter:creator" content="@thinkyhead"> <script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Coding Standards","author":{"@type":"Person","name":"thinkyhead"},"datePublished":"2018-10-31T03:43:26+00:00","dateModified":"2018-10-31T03:43:26+00:00","description":"Guidelines for Marlin code formatting, methodologies, and standards.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://marlinfw.org/assets/images/logo/marlin/small.png"},"name":"thinkyhead"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://marlinfw.org/docs/development/coding_standards.html"},"url":"http://marlinfw.org/docs/development/coding_standards.html"}</script> <link rel="icon" href="/assets/favicon.ico"> <link rel="stylesheet" href="/assets/stylesheets/main.css"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script src="/assets/javascript/head.min.js"></script> <script type="text/javascript">
      /**
       * As Github pages do not support https for custom domains
       * this is the current best workaround for #18.
       */
      var domains  = ['marlinfw.org', 'localhost', '127.0.0.1' ];
      var pathname = location.pathname.replace(/^\/MarlinDocumentation/, '')
      if (domains.indexOf(window.location.hostname) == -1)
          window.top.location.href = 'http://marlinfw.org' + pathname;

      /**
       * Another ugly workaround trying to improve UX reported by #35
       */
       if (location.protocol != 'http:')
           location.href = 'http:' + window.location.href.substring(window.location.protocol.length);

      /**
       * Improves overall speed by loading javascript and css resources in parallel
       * with the main page.
       */
      head.load(
          "/assets/stylesheets/font-awesome.min.css",

          "/assets/javascript/jquery-2.2.1.min.js",
          "/assets/javascript/jquery-ui.min.js",
          "/assets/javascript/bootstrap.min.js",
          "/assets/javascript/tocify.min.js",
          "/assets/javascript/custom.js",

          "/assets/javascript/sheetrock.min.js",
          "/assets/javascript/cookieconsent.min.js"
      );

      head.ready(function() {
        window.cookieconsent_options = {
          "message":"We use cookies to ensure you get the best experience on our website",
          "dismiss": "Got it!", "learnMore": "More info", "link":"", "theme": "dark-bottom"
        };
      });
    </script> </head> <body role="document"> <nav class="navbar navbar-default navbar-fixed-top custom-no-margin"> <div class="container"> <div class="navbar-header"> <a href="/" class="navbar-brand"> <img src="/assets/images/logo/marlin/text-25.png" alt="Marlin"> </a> <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> </div> <div class="navbar-collapse collapse" id="navbar-main"> <ul class="nav navbar-nav"> <li><a href="/docs/basics/introduction.html">About Marlin</a></li> <li><a href="/meta/download/">Download</a></li> <li><a href="/docs/configuration/configuration.html">Configure</a></li> <li><a href="/docs/basics/install.html">Install</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-tools">Tools <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/tools/u8glib/converter.html">Bitmap Converter</a></li> <li><a href="/tools/lin_advance/k-factor.html">K-Factor Calibration Pattern</a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin/issues">Bugtracker</a></li> <li><a href="/docs/basics/reporting_bugs.html">Reporting bugs</a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin">Source Code Repository</a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-documentation">Documentation <span class="caret"></span></a> <ul class="dropdown-menu"> <li class="dropdown-submenu configuration"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration</a> <ul class="dropdown-menu"> <li><a href="/meta/configuration/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/configuration/configuration.html"> Configuring Marlin 1.1 </a></li> <li><a href="/docs/configuration/laser_spindle.html"> Laser/Spindle Configuration </a></li> <li><a href="/docs/configuration/probes.html"> Probe Configuration </a></li> </ul> </li> <li class="dropdown-submenu development"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development</a> <ul class="dropdown-menu"> <li><a href="/meta/development/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/development/boards.html"> Boards </a></li> <li class="divider"> </li> <li><a href="/docs/development/coding_standards.html"> Coding Standards </a></li> <li><a href="/docs/development/getting_started_pull_requests.html"> Contributing Code with Pull Requests </a></li> <li><a href="/docs/development/git_scripts.html"> Marlin Github Scripts </a></li> <li class="divider"> </li> <li><a href="/docs/development/contributing.html"> Contributing to Marlin </a></li> <li><a href="/docs/development/feature_request.html"> Feature requests </a></li> <li class="divider"> </li> <li><a href="/docs/development/fonts.html"> Adding new fonts </a></li> <li><a href="/docs/development/lcd_language.html"> LCD Language System </a></li> </ul> </li> <li class="dropdown-submenu features"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features</a> <ul class="dropdown-menu"> <li><a href="/meta/features/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/features/auto_bed_leveling.html"> Automatic Bed Leveling </a></li> <li><a href="/docs/features/unified_bed_leveling.html"> Unified Bed Leveling </a></li> <li class="divider"> </li> <li><a href="/docs/features/fwretract.html"> Firmware Retract </a></li> <li><a href="/docs/features/lin_advance.html"> Linear Advance </a></li> <li><a href="/docs/features/tmc_drivers.html"> Trinamic drivers </a></li> <li class="divider"> </li> <li><a href="/docs/features/lcd_menu.html"> LCD Menu Tree </a></li> </ul> </li> <li class="dropdown-submenu gcode"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">G-code</a> <ul class="dropdown-menu"> <li><a href="/meta/gcode/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/gcode/G000-G001.html"> G0-G1: Linear Move </a></li> <li><a href="/docs/gcode/G002-G003.html"> G2-G3: Controlled Arc Move </a></li> <li><a href="/docs/gcode/G004.html"> G4: Dwell </a></li> <li><a href="/docs/gcode/G005.html"> G5: BÃ©zier cubic spline </a></li> <li><a href="/docs/gcode/G010.html"> G10: Retract </a></li> <li><a href="/docs/gcode/G011.html"> G11: Recover </a></li> <li><a href="/docs/gcode/G012.html"> G12: Clean the Nozzle </a></li> <li><a href="/docs/gcode/G020.html"> G20: Inch Units </a></li> <li><a href="/docs/gcode/G021.html"> G21: Millimeter Units </a></li> <li><a href="/docs/gcode/G026.html"> G26: Mesh Validation Pattern </a></li> <li><a href="/docs/gcode/G027.html"> G27: Park the nozzle </a></li> <li><a href="/docs/gcode/G028.html"> G28: Auto Home </a></li> <li><a href="/docs/gcode/G029-mbl.html"> G29: Mesh Bed Leveling </a></li> <li><a href="/docs/gcode/G029-abl.html"> G29: Automatic Bed Leveling </a></li> <li><a href="/docs/gcode/G029-ubl.html"> G29: Unified Bed Leveling </a></li> <li><a href="/docs/gcode/G030.html"> G30: Single Z-Probe </a></li> <li><a href="/docs/gcode/G031.html"> G31: Dock Sled </a></li> <li><a href="/docs/gcode/G032.html"> G32: Undock Sled </a></li> <li><a href="/docs/gcode/G033.html"> G33: Delta Auto Calibration </a></li> <li><a href="/docs/gcode/G038.html"> G38.2-G38.3: Probe target </a></li> <li><a href="/docs/gcode/G042.html"> G42: Move to mesh coordinate </a></li> <li><a href="/docs/gcode/G090.html"> G90: Absolute Positioning </a></li> <li><a href="/docs/gcode/G091.html"> G91: Relative Positioning </a></li> <li><a href="/docs/gcode/G092.html"> G92: Set Position </a></li> <li><a href="/docs/gcode/M000-M001.html"> M0-M1: Unconditional stop </a></li> <li><a href="/docs/gcode/M003.html"> M3: Spindle CW / Laser On </a></li> <li><a href="/docs/gcode/M004.html"> M4: Spindle CCW / Laser On </a></li> <li><a href="/docs/gcode/M005.html"> M5: Spindle / Laser Off </a></li> <li><a href="/docs/gcode/M017.html"> M17: Enable Steppers </a></li> <li><a href="/docs/gcode/M018.html"> M18-M84: Disable steppers </a></li> <li><a href="/docs/gcode/M020.html"> M20: List SD Card </a></li> <li><a href="/docs/gcode/M021.html"> M21: Init SD card </a></li> <li><a href="/docs/gcode/M022.html"> M22: Release SD card </a></li> <li><a href="/docs/gcode/M023.html"> M23: Select SD file </a></li> <li><a href="/docs/gcode/M024.html"> M24: Start or Resume SD print </a></li> <li><a href="/docs/gcode/M025.html"> M25: Pause SD print </a></li> <li><a href="/docs/gcode/M026.html"> M26: Set SD position </a></li> <li><a href="/docs/gcode/M027.html"> M27: Report SD print status </a></li> <li><a href="/docs/gcode/M028.html"> M28: Start SD write </a></li> <li><a href="/docs/gcode/M029.html"> M29: Stop SD write </a></li> <li><a href="/docs/gcode/M030.html"> M30: Delete SD file </a></li> <li><a href="/docs/gcode/M031.html"> M31: Print time </a></li> <li><a href="/docs/gcode/M032.html"> M32: Select and Start </a></li> <li><a href="/docs/gcode/M033.html"> M33: Get Long Path </a></li> <li><a href="/docs/gcode/M034.html"> M34: SDCard Sorting </a></li> <li><a href="/docs/gcode/M042.html"> M42: Set Pin State </a></li> <li><a href="/docs/gcode/M043.html"> M43: Debug Pins </a></li> <li><a href="/docs/gcode/M043-T.html"> M43 T: Toggle Details (Debug Pins) </a></li> <li><a href="/docs/gcode/M048.html"> M48: Probe Accuracy Test </a></li> <li><a href="/docs/gcode/M073.html"> M73: Set Print Progress </a></li> <li><a href="/docs/gcode/M075.html"> M75: Start Print Job </a></li> <li><a href="/docs/gcode/M076.html"> M76: Pause Print Job </a></li> <li><a href="/docs/gcode/M077.html"> M77: Stop Print Job </a></li> <li><a href="/docs/gcode/M078.html"> M78: Print Job Stats </a></li> <li><a href="/docs/gcode/M080.html"> M80: Power On </a></li> <li><a href="/docs/gcode/M081.html"> M81: Power Off </a></li> <li><a href="/docs/gcode/M082.html"> M82: E Absolute </a></li> <li><a href="/docs/gcode/M083.html"> M83: E Relative </a></li> <li><a href="/docs/gcode/M085.html"> M85: Inactivity Shutdown </a></li> <li><a href="/docs/gcode/M092.html"> M92: Set Axis Steps-per-unit </a></li> <li><a href="/docs/gcode/M100.html"> M100: Free Memory </a></li> <li><a href="/docs/gcode/M104.html"> M104: Set Hotend Temperature </a></li> <li><a href="/docs/gcode/M105.html"> M105: Report Temperatures </a></li> <li><a href="/docs/gcode/M106.html"> M106: Set Fan Speed </a></li> <li><a href="/docs/gcode/M107.html"> M107: Fan Off </a></li> <li><a href="/docs/gcode/M108.html"> M108: Break and Continue </a></li> <li><a href="/docs/gcode/M109.html"> M109: Wait for Hotend Temperature </a></li> <li><a href="/docs/gcode/M110.html"> M110: Set Line Number </a></li> <li><a href="/docs/gcode/M111.html"> M111: Debug Level </a></li> <li><a href="/docs/gcode/M112.html"> M112: Emergency Stop </a></li> <li><a href="/docs/gcode/M113.html"> M113: Host Keepalive </a></li> <li><a href="/docs/gcode/M114.html"> M114: Get Current Position </a></li> <li><a href="/docs/gcode/M115.html"> M115: Firmware Info </a></li> <li><a href="/docs/gcode/M117.html"> M117: Set LCD Message </a></li> <li><a href="/docs/gcode/M118.html"> M118: Serial print </a></li> <li><a href="/docs/gcode/M119.html"> M119: Endstop States </a></li> <li><a href="/docs/gcode/M120.html"> M120: Enable Endstops </a></li> <li><a href="/docs/gcode/M121.html"> M121: Disable Endstops </a></li> <li><a href="/docs/gcode/M122.html"> M122: TMC Debugging </a></li> <li><a href="/docs/gcode/M125.html"> M125: Park Head </a></li> <li><a href="/docs/gcode/M126.html"> M126: Baricuda 1 Open </a></li> <li><a href="/docs/gcode/M127.html"> M127: Baricuda 1 Close </a></li> <li><a href="/docs/gcode/M128.html"> M128: Baricuda 2 Open </a></li> <li><a href="/docs/gcode/M129.html"> M129: Baricuda 2 Close </a></li> <li><a href="/docs/gcode/M140.html"> M140: Set Bed Temperature </a></li> <li><a href="/docs/gcode/M145.html"> M145: Set Material Preset </a></li> <li><a href="/docs/gcode/M149.html"> M149: Set Temperature Units </a></li> <li><a href="/docs/gcode/M150.html"> M150: Set RGB(W) Color </a></li> <li><a href="/docs/gcode/M155.html"> M155: Temperature Auto-Report </a></li> <li><a href="/docs/gcode/M163.html"> M163: Set Mix Factor </a></li> <li><a href="/docs/gcode/M164.html"> M164: Save Mix </a></li> <li><a href="/docs/gcode/M165.html"> M165: Set Mix </a></li> <li><a href="/docs/gcode/M190.html"> M190: Wait for Bed Temperature </a></li> <li><a href="/docs/gcode/M200.html"> M200: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M201.html"> M201: Set Print Max Acceleration </a></li> <li><a href="/docs/gcode/M203.html"> M203: Set Max Feedrate </a></li> <li><a href="/docs/gcode/M204.html"> M204: Set Starting Acceleration </a></li> <li><a href="/docs/gcode/M205.html"> M205: Set Advanced Settings </a></li> <li><a href="/docs/gcode/M206.html"> M206: Set Home Offsets </a></li> <li><a href="/docs/gcode/M207.html"> M207: Set Firmware Retraction </a></li> <li><a href="/docs/gcode/M208.html"> M208: Set Firmware Recovery </a></li> <li><a href="/docs/gcode/M209.html"> M209: Set Auto Retract </a></li> <li><a href="/docs/gcode/M211.html"> M211: Software Endstops </a></li> <li><a href="/docs/gcode/M217.html"> M217: Filament swap parameters </a></li> <li><a href="/docs/gcode/M218.html"> M218: Set Hotend Offset </a></li> <li><a href="/docs/gcode/M220.html"> M220: Set Feedrate Percentage </a></li> <li><a href="/docs/gcode/M221.html"> M221: Set Flow Percentage </a></li> <li><a href="/docs/gcode/M226.html"> M226: Wait for Pin State </a></li> <li><a href="/docs/gcode/M240.html"> M240: Trigger Camera </a></li> <li><a href="/docs/gcode/M250.html"> M250: LCD Contrast </a></li> <li><a href="/docs/gcode/M260.html"> M260: I2C Send </a></li> <li><a href="/docs/gcode/M261.html"> M261: I2C Request </a></li> <li><a href="/docs/gcode/M280.html"> M280: Servo Position </a></li> <li><a href="/docs/gcode/M290.html"> M290: Babystep </a></li> <li><a href="/docs/gcode/M300.html"> M300: Play Tone </a></li> <li><a href="/docs/gcode/M301.html"> M301: Set Hotend PID </a></li> <li><a href="/docs/gcode/M302.html"> M302: Cold Extrude </a></li> <li><a href="/docs/gcode/M303.html"> M303: PID autotune </a></li> <li><a href="/docs/gcode/M304.html"> M304: Set Bed PID </a></li> <li><a href="/docs/gcode/M350.html"> M350: Set micro-stepping </a></li> <li><a href="/docs/gcode/M351.html"> M351: Set Microstep Pins </a></li> <li><a href="/docs/gcode/M355.html"> M355: Case Light Control </a></li> <li><a href="/docs/gcode/M360.html"> M360: SCARA Theta A </a></li> <li><a href="/docs/gcode/M361.html"> M361: SCARA Theta-B </a></li> <li><a href="/docs/gcode/M362.html"> M362: SCARA Psi-A </a></li> <li><a href="/docs/gcode/M363.html"> M363: SCARA Psi-B </a></li> <li><a href="/docs/gcode/M364.html"> M364: SCARA Psi-C </a></li> <li><a href="/docs/gcode/M380.html"> M380: Activate Solenoid </a></li> <li><a href="/docs/gcode/M381.html"> M381: Deactivate Solenoids </a></li> <li><a href="/docs/gcode/M400.html"> M400: Finish Moves </a></li> <li><a href="/docs/gcode/M401.html"> M401: Deploy Probe </a></li> <li><a href="/docs/gcode/M402.html"> M402: Stow Probe </a></li> <li><a href="/docs/gcode/M404.html"> M404: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M405.html"> M405: Filament Width Sensor On </a></li> <li><a href="/docs/gcode/M406.html"> M406: Filament Width Sensor Off </a></li> <li><a href="/docs/gcode/M407.html"> M407: Filament Width </a></li> <li><a href="/docs/gcode/M410.html"> M410: Quickstop </a></li> <li><a href="/docs/gcode/M420.html"> M420: Bed Leveling State </a></li> <li><a href="/docs/gcode/M421.html"> M421: Set Mesh Value </a></li> <li><a href="/docs/gcode/M428.html"> M428: Home Offsets Here </a></li> <li><a href="/docs/gcode/M500.html"> M500: Save Settings </a></li> <li><a href="/docs/gcode/M501.html"> M501: Restore Settings </a></li> <li><a href="/docs/gcode/M502.html"> M502: Factory Reset </a></li> <li><a href="/docs/gcode/M503.html"> M503: Report Settings </a></li> <li><a href="/docs/gcode/M504.html"> M504: Validate EEPROM contents </a></li> <li><a href="/docs/gcode/M524.html"> M524: Abort SD print </a></li> <li><a href="/docs/gcode/M540.html"> M540: Endstops Abort SD </a></li> <li><a href="/docs/gcode/M600.html"> M600: Filament Change </a></li> <li><a href="/docs/gcode/M603.html"> M603: Configure Filament Change </a></li> <li><a href="/docs/gcode/M605.html"> M605: Dual Nozzle Mode </a></li> <li><a href="/docs/gcode/M665.html"> M665: Delta Configuration </a></li> <li><a href="/docs/gcode/M665-scara.html"> M665: SCARA Configuration </a></li> <li><a href="/docs/gcode/M666.html"> M666: Set Delta endstop adjustments </a></li> <li><a href="/docs/gcode/M666-dual.html"> M666: Set dual endstop offsets </a></li> <li><a href="/docs/gcode/M851.html"> M851: Z Probe Offset </a></li> <li><a href="/docs/gcode/M852.html"> M852: Bed Skew Compensation </a></li> <li><a href="/docs/gcode/M900.html"> M900: Linear Advance Factor </a></li> <li><a href="/docs/gcode/M906.html"> M906: TMC Motor Current </a></li> <li><a href="/docs/gcode/M907.html"> M907: Set Motor Current </a></li> <li><a href="/docs/gcode/M908.html"> M908: Set Trimpot Pins </a></li> <li><a href="/docs/gcode/M909.html"> M909: DAC Print Values </a></li> <li><a href="/docs/gcode/M910.html"> M910: Commit DAC to EEPROM </a></li> <li><a href="/docs/gcode/M911.html"> M911: TMC OT Pre-Warn Condition </a></li> <li><a href="/docs/gcode/M912.html"> M912: Clear TMC OT Pre-Warn </a></li> <li><a href="/docs/gcode/M913.html"> M913: Set Hybrid Threshold Speed </a></li> <li><a href="/docs/gcode/M914.html"> M914: TMC Bump Sensitivity </a></li> <li><a href="/docs/gcode/M915.html"> M915: TMC Z axis calibration </a></li> <li><a href="/docs/gcode/M928.html"> M928: Start SD Logging </a></li> <li><a href="/docs/gcode/M999.html"> M999: STOP Restart </a></li> </ul> </li> <li class="dropdown-submenu hardware"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware</a> <ul class="dropdown-menu"> <li><a href="/meta/hardware/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/hardware/boards.html"> Boards </a></li> <li><a href="/docs/hardware/endstops.html"> Endstops </a></li> <li><a href="/docs/hardware/tmc_drivers.html"> Trinamic drivers </a></li> </ul> </li> <li class="divider"> </li> <li><a href="/meta/needs-review/">Documentation Needing Review</a></li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right visible-lg-block"> <li><a href="https://github.com/MarlinFirmware/MarlinDocumentation/edit/master/_development/coding_standards.md" data-proofer-ignore> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Improve this page</span> </a></li> </ul> </div> </div> </nav> <div class="container" role="main"> <div class="row"> <div class="col-lg-3 col-md-4 visible-lg-block visible-md-block custom-no-padding"> <div class="custom-fixed-sidebar"> <div id="toc"></div> </div> </div> <div class="col-lg-9 col-md-8 custom-bg-white"> <div class="row"> <div class="col-md-12 custom-article"> <p class="text-right pull-right visible-lg-block hidden-print small custom-pt25"> <a href="https://github.com/thinkyhead" data-toggle="tooltip" data-placement="bottom" title="Visit thinkyhead's profile on Github"><img class="avatar avatar-small" src="https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=30" alt="thinkyhead" srcset="https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=30 1x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=60 2x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=90 3x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> </p> <h1 class="custom-article-header">Coding Standards</h1> <hr> <p>Please follow the formatting guidelines and coding standards below when contributing code to Marlin. Pull requests that donât follow the existing coding style closely may be postponed for cleanup. Your code reviewer should point out where changes are needed.</p> <h2 id="coding-style">Coding Style</h2> <h3 id="indentation">Indentation</h3> <p>Indentation is important for readability and maintainability of code, and provides guidance for naÃ¯ve code editors (e.g., TextMate, Sublime, et. al.) to properly fold code blocks by level.</p> <ul> <li>Entab lines with 2 spaces and donât use tabs. <em>Set your editor to use 2 Spaces! Tabs will bite you in the end.</em> </li> <li>All block elements should increase the indentation level, including <code class="highlighter-rouge">#if</code> blocks and other non-brace compiler blocks:</li> </ul> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="kt">void</span> <span class="nf">myFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">myCondition</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="cp">#ifdef PETER_PARKER
</span>      <span class="n">slingWeb</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="cp">#else
</span>      <span class="n">findPhoneBooth</span><span class="p">();</span>
    <span class="cp">#endif
</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre> </div> <h3 id="brace-style">Brace-style</h3> <p>Marlin uses a brace style intended to</p> <ul> <li>show the folded code block at the end of its opening line: <code class="highlighter-rouge"><span class="p">{</span></code><code class="highlighter-rouge">(...)</code>,</li> <li>maintain consistency and develop a single style habit, and</li> <li>maximize the number of code lines on-screen.</li> </ul> <p>If vertical spacing makes code more readable, add <em>one</em> extra blank line rather than using a different brace style.</p> <ul> <li>Known by the Ancients as <a href="https://en.wikipedia.org/wiki/Indent_style#Variant:_1TBS_.28OTBS.29">âOne True Brace Styleâ</a> </li> <li>Place opening braces at the end of the line: <code class="highlighter-rouge">if (a == 1) {</code> </li> <li>Do the same for a declaration line: <code class="highlighter-rouge">void pizza(int slices) {</code> </li> <li>Vertically align closing braces to the opening line.</li> </ul> <p>Hereâs an example of 1TBS style applied to a faux function:</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="kt">void</span> <span class="nf">my_function</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>

  <span class="k">switch</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span> <span class="n">SERIAL_CHAR</span><span class="p">(</span><span class="sc">'Q'</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span> <span class="n">SERIAL_CHAR</span><span class="p">(</span><span class="sc">'T'</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre> </div> <h3 id="spacing">Spacing</h3> <ul> <li>One space after control keywords:<br><code class="highlighter-rouge">if (â¦)</code>, <code class="highlighter-rouge">while (â¦)</code>, <code class="highlighter-rouge">do {â¦} while(â¦)</code>, <code class="highlighter-rouge">switch (â¦)</code> etc.</li> <li>No space is needed for <code class="highlighter-rouge">sizeof()</code> and other âfunction-likeâ language features.</li> <li>No space between a function and its arguments: <code class="highlighter-rouge">val = myFunction(â¦);</code> </li> <li>No spaces around <code class="highlighter-rouge">.</code> or <code class="highlighter-rouge">-&gt;</code> operators: <code class="highlighter-rouge">the_place = state-&gt;parks[echo];</code> </li> <li>No space between a cast and its target: <code class="highlighter-rouge">old_state = (int)state;</code> </li> <li>Use one space around (on each side of) most binary and ternary operators:<br><code class="highlighter-rouge">myVar = aVar + bVar * cVar;</code><br><code class="highlighter-rouge">myVal = (a * b + b * c);</code> </li> </ul> <h3 id="trailing-whitespace">Trailing Whitespace</h3> <p>Donât leave trailing whitespace at the ends of lines. Some editors will auto-indent new lines, leaving extra whitespace behind on blank lines. As a result, you end up with lines containing trailing whitespace.</p> <p>Git can warn you about patches that introduce trailing whitespace, and optionally strip the trailing whitespace for you; however, if applying a series of patches, this may make later patches in the series fail by changing their context lines.</p> <h3 id="commenting">Commenting</h3> <p>Comments are good, but avoid over-commenting. <em>Never</em> try to explain <em>how</em> your code works in a comment: itâs much better to write the code so that the working is obvious, and itâs a waste of time to explain badly written code.</p> <p>Generally, you want your comments to explain <em>what</em> your code does, not <em>how</em>. Keep comments inside a function body short. If a function is so complex that you need to separately comment parts of it, consider splitting it up into simpler units. Make small comments to note or warn about something particularly clever (or ugly), but avoid excess. Reserve detailed comments for the head of the function, explaining what it does, and possibly <em>why</em> it does it.</p> <ul> <li>Use Doxygen-style comments for functions, classes, and other defined entities, and concentrate documentation in the <code class="highlighter-rouge">.h</code> files.</li> </ul> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cm">/**
 * This is the preferred style for multi-line comments in the
 * Marlin Firmware source code. Please use it consistently.
 *
 * This mimics Doxygen/HeaderDoc style, and once keywords are added
 * we'll be able to auto-generate code documentation and provide more
 * complete development guidance.
 */</span>
</code></pre> </div> <ul> <li>Use C++ single-line style with <code class="highlighter-rouge">//</code> for comments under 3 lines.</li> </ul> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="c1">// A short comment that takes up only a line or two
// should just use end-of-line comment style.
</span></code></pre> </div> <h2 id="names-and-symbols">Names and Symbols</h2> <h3 id="filenames">Filenames</h3> <p>Filenames for Marlin code should favor <code class="highlighter-rouge">lowercase_with_underscores.ext</code> format. Contributed code will follow its own standard.</p> <ul> <li>use <code class="highlighter-rouge">.cpp</code> for C++ sources</li> <li>use <code class="highlighter-rouge">.c</code> for C only sources</li> <li>use <code class="highlighter-rouge">.h</code> for headers of all types</li> </ul> <h3 id="directories">Directories</h3> <ul> <li>Lowercase names.</li> <li>Marlin 1.0.x and 1.1.x retain a flat file layout</li> <li>Marlin 1.2.x and up adopts a hierarchical file layout</li> </ul> <h3 id="capitalization">Capitalization</h3> <p>For Marlin variables, data members, functions, and methods use <code class="highlighter-rouge">lowercase_with_underscores</code>. Use <code class="highlighter-rouge">camelCase</code> names only when class names and methods already uses that format. Marlin classes may use <code class="highlighter-rouge">MyClassName</code> format or <code class="highlighter-rouge">my_class_name</code>. Core classes tend to use camel-case, with general-purpose classes using underscore format.</p> <ul> <li><code class="highlighter-rouge">my_function_name(int in_integer, float in_float=0.0)</code></li> <li> <code class="highlighter-rouge">MyClass</code>, <code class="highlighter-rouge">classMethod</code>, <code class="highlighter-rouge">classData</code> </li> <li> <code class="highlighter-rouge">local_variable</code>, <code class="highlighter-rouge">global_variable</code>, <code class="highlighter-rouge">const_value</code> </li> <li> <code class="highlighter-rouge">MACRO_NAME</code> â anything created with <code class="highlighter-rouge">#define</code> </li> <li><code class="highlighter-rouge">EnumeratedType</code></li> </ul> <h3 id="libraries">Libraries</h3> <p>Whenever possible, use the functions supplied by avr-libc or Arduino bundled libraries. Any libraries required to compile Marlin should be included in the package so that they are guaranteed to be compatible versions.</p> <h2 id="language-features">Language Features</h2> <p>Marlin is written in C/C++ and needs be able to compile with the supplied <code class="highlighter-rouge">Makefile</code> or an up-to-date version of Arduino. With Marlin 1.1 we now support building with Arduino IDE, Teensyduino, PlatformIO, <code class="highlighter-rouge">make</code>, and <code class="highlighter-rouge">cmake</code>.</p> <p>Going forward, Marlin does not need to be backward-compatible with older (pre-2017) toolchains. The minimum requirement for Marlin 1.1.x is Arduino IDE 1.6.8.</p> <ul> <li> <strong>Do not use</strong> extended C++ features like: <ul> <li>Exceptions (throw / catch)</li> <li>Virtual functions / classes</li> <li>Standard Template Library (STL)</li> </ul> </li> <li> <strong>Do use</strong> modern C++11 features like: <ul> <li> <code class="highlighter-rouge">constexpr</code> values and functions.</li> <li> <code class="highlighter-rouge">static_assert(test,"error")</code> to sanity-check <code class="highlighter-rouge">float</code> and <code class="highlighter-rouge">constexpr</code> values.</li> </ul> </li> </ul> <h3 id="primitive-types">Primitive Types</h3> <ul> <li>Favor bit-size types like <code class="highlighter-rouge">uint8_t</code> and <code class="highlighter-rouge">int32_t</code> over <code class="highlighter-rouge">short</code>, <code class="highlighter-rouge">int</code>, and <code class="highlighter-rouge">long</code>. This helps to keep behavior consistent across architectures.</li> <li>AVR recasts <code class="highlighter-rouge">double</code> as <code class="highlighter-rouge">float</code>, so both are 32 bits long. Favor <code class="highlighter-rouge">float</code> and avoid <code class="highlighter-rouge">double</code> unless the extra precision is needed on a 32-bit architecture.</li> </ul> <h3 id="memory-usage">Memory Usage</h3> <ul> <li>Dynamic allocation (<code class="highlighter-rouge">malloc()</code>, <code class="highlighter-rouge">free()</code>, <code class="highlighter-rouge">new</code>, <code class="highlighter-rouge">delete</code>) is <strong><em>verboten</em></strong>!</li> <li>Avoid unconstrained recursion so the stack wonât explode.</li> <li>Avoid using globals and <code class="highlighter-rouge">static</code> locals because SRAM is a precious resource.</li> <li>Use <code class="highlighter-rouge">PSTR</code> and <code class="highlighter-rouge">PROGMEM</code> macros to keep strings in Program Memory.</li> </ul> <h3 id="minimize-repetition">Minimize Repetition</h3> <p>When possible, use macros, small functions, and other clever techniques to avoid redundancy. For example, instead of thisâ¦</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cp">#if ENABLED(FEATURE_ONE)
</span>  <span class="k">const</span> <span class="kt">char</span> <span class="n">blue</span> <span class="o">=</span> <span class="sc">'1'</span><span class="p">;</span>
<span class="cp">#else
</span>  <span class="k">const</span> <span class="kt">char</span> <span class="n">blue</span> <span class="o">=</span> <span class="sc">'0'</span><span class="p">;</span>
<span class="cp">#endif
</span></code></pre> </div> <p>â¦do thisâ¦</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="n">blue</span> <span class="o">=</span>
  <span class="cp">#if ENABLED(FEATURE_ONE)
</span>    <span class="sc">'1'</span>
  <span class="cp">#else
</span>    <span class="sc">'0'</span>
  <span class="cp">#endif
</span><span class="p">;</span>
</code></pre> </div> <h3 id="avoid-expensive-code">Avoid Expensive Code</h3> <ul> <li> <code class="highlighter-rouge">millis()</code> can be expensive so put it in a <code class="highlighter-rouge">const millis_t var</code> if you need to use the value more than once. (And always use the <code class="highlighter-rouge">ELAPSED</code>/<code class="highlighter-rouge">PENDING</code> macros - see below.)</li> <li>Pre-calculate instead of calculating on the fly, when possible.</li> <li>Use multiplication (of the reciprocal) instead of division, when possible.</li> <li>Most code doesnât need to be optimized for speed, so favor smaller code.</li> </ul> <h3 id="best-practices-for-include">Best-Practices for #include</h3> <ul> <li>Follow best practices for <code class="highlighter-rouge">#include</code>. <ul> <li>Only include the headers needed to provide the definitions required by the current source file. This helps provide an accurate view of dependencies.</li> <li>Include <code class="highlighter-rouge">Marlin.h</code> only when you need its externs. Donât include <code class="highlighter-rouge">Marlin.h</code> when just <code class="highlighter-rouge">MarlinConfig.h</code> (or <code class="highlighter-rouge">MarlinConfigPre.h</code>) will do.</li> <li>Included headers should be arranged in the following order: <ul> <li> <code class="highlighter-rouge">MarlinConfig.h</code> (or <code class="highlighter-rouge">MarlinConfigPre.h</code>), if configuration values are needed for <code class="highlighter-rouge">#if</code> or other uses.</li> <li>After the main <code class="highlighter-rouge">#if</code> condition, include the fileâs own corresponding header.</li> <li>Next, arrange project headers to prevent hiding broken dependencies. For example, if <code class="highlighter-rouge">grape.h</code> depends on <code class="highlighter-rouge">orange.h</code>, try to include <code class="highlighter-rouge">grape.h</code> before <code class="highlighter-rouge">orange.h</code> so that if <code class="highlighter-rouge">grape.h</code> fails to include <code class="highlighter-rouge">orange.h</code> an error will be thrown.</li> <li>Last come system and library headers, such as <code class="highlighter-rouge">&lt;Arduino.h&gt;</code>, <code class="highlighter-rouge">&lt;inttypes.h&gt;</code>, and <code class="highlighter-rouge">&lt;u8glib.h&gt;</code>.</li> </ul> </li> </ul> </li> </ul> <h2 id="marlin-specific-conventions">Marlin-specific Conventions</h2> <h3 id="preprocessor-directives">Preprocessor directives</h3> <ul> <li>Use <code class="highlighter-rouge">#define</code> instead of <code class="highlighter-rouge">const</code> for configurable values</li> <li>Donât use <code class="highlighter-rouge">#if</code> / <code class="highlighter-rouge">#endif</code> for commenting-out unused, old or broken code. We have a git repository! If itâs obsolete, delete it.</li> <li>Use <code class="highlighter-rouge">#if ENABLED(FEATURE_NAME)</code> / <code class="highlighter-rouge">#endif</code> to compile enabled features. (Using these macros allows features to be set externally.)</li> <li>Use <code class="highlighter-rouge">#if DISABLED(FEATURE_NAME)</code> / <code class="highlighter-rouge">#endif</code> to compile disabled features. (Using these macros allows features to be set externally.)</li> <li>Use <code class="highlighter-rouge">#define</code> macros to avoid repeating boilerplate code.<br>Consider both readability and maintainability.</li> <li>Label <code class="highlighter-rouge">#endif</code> with the opening <code class="highlighter-rouge">#if</code> condition(s) if the block is over ~15 lines. Make the label compact. For example, <code class="highlighter-rouge">#endif // SDSUPPORT || ULTRALCD</code>.</li> </ul> <h3 id="fastio">FastIO</h3> <p>Marlin uses FastIO macros to read and write pins.</p> <table class="pretty-list headless"> <thead> <tr> <th>Macro</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">READ(PIN)</code></td> <td>Read the state of a digital pin. Returns either <code class="highlighter-rouge">HIGH</code> or <code class="highlighter-rouge">LOW</code>.</td> </tr> <tr> <td><code class="highlighter-rouge">WRITE(PIN, STATE)</code></td> <td>Set a digital pinâs state to either <code class="highlighter-rouge">HIGH</code> or <code class="highlighter-rouge">LOW</code>.</td> </tr> </tbody> </table> <h3 id="macros">Macros</h3> <p>Marlin provides several shorthand macros in the <code class="highlighter-rouge">macros.h</code> file. Get to know them and use them. Here are some of the most common:</p> <table class="pretty-list headless"> <thead> <tr> <th>Macro</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td> <code class="highlighter-rouge">ENABLED(OPTION)</code>/<code class="highlighter-rouge">DISABLED(OPTION)</code> </td> <td>Test whether an option is on/off. (Precompiler only.) These macros are required so that <code class="highlighter-rouge">make</code> can set options.</td> </tr> <tr> <td><code class="highlighter-rouge">COUNT(array)</code></td> <td>Count the number of items in an array in-place. e.g., <code class="highlighter-rouge">for (i = 0; i &lt; COUNT(my_arr); i++)</code>â¦</td> </tr> <tr> <td><code class="highlighter-rouge">WITHIN(var,low,high)</code></td> <td>Check that a variable is within a given range, inclusive.</td> </tr> <tr> <td><code class="highlighter-rouge">NUMERIC(c)</code></td> <td>True if a character is numeric: <code class="highlighter-rouge">0123456789</code> </td> </tr> <tr> <td><code class="highlighter-rouge">DECIMAL(c)</code></td> <td>True if a character is decimal: <code class="highlighter-rouge">0123456789.</code> </td> </tr> <tr> <td><code class="highlighter-rouge">NUMERIC_SIGNED(c)</code></td> <td>True if a character is signed numeric: <code class="highlighter-rouge">0123456789+-</code> </td> </tr> <tr> <td><code class="highlighter-rouge">DECIMAL_SIGNED(c)</code></td> <td>True if a character is signed decimal: <code class="highlighter-rouge">0123456789+-.</code> </td> </tr> <tr> <td> <code class="highlighter-rouge">NOLESS(var,min)</code>/<code class="highlighter-rouge">NOMORE(var,max)</code> </td> <td>Constrain a variable to a minimum or maximum value.</td> </tr> <tr> <td><code class="highlighter-rouge">FORCE_INLINE</code></td> <td>Force a function or method to be compiled inline (almost like a macro).</td> </tr> <tr> <td><code class="highlighter-rouge">STRINGIFY(DEFINE)</code></td> <td>Resolve a define to a quoted string. (If undefined, the name of the define.)</td> </tr> <tr> <td><code class="highlighter-rouge">ARRAY_N(N,values)</code></td> <td>Expand into a prepopulated array of size N (based on an option like <code class="highlighter-rouge">EXTRUDERS</code>).</td> </tr> <tr> <td><code class="highlighter-rouge">PIN_EXISTS(NAME)</code></td> <td>True if the pin is defined. Precompiler only. (Takes the name minus <code class="highlighter-rouge">_PIN</code>.)</td> </tr> <tr> <td> <code class="highlighter-rouge">NEAR_ZERO(V)</code>/<code class="highlighter-rouge">UNEAR_ZERO(V)</code>/<code class="highlighter-rouge">NEAR(V1,V2)</code> </td> <td>Check whether a float value is very near zero or another value.</td> </tr> <tr> <td><code class="highlighter-rouge">RECIPROCAL(N)</code></td> <td>The reciprocal of a value, except return 0.0 (not infinity) for 0.0.</td> </tr> <tr> <td> <code class="highlighter-rouge">RADIANS(d)</code>/<code class="highlighter-rouge">DEGREES(r)</code> </td> <td>Convert degrees to radians and back again.</td> </tr> <tr> <td><code class="highlighter-rouge">FIXFLOAT(N)</code></td> <td>Add a tiny value to a float to compensate for rounding errors.</td> </tr> <tr> <td><code class="highlighter-rouge">NOOP</code></td> <td>A do-nothing macro to use for empty macro functions.</td> </tr> </tbody> </table> <h3 id="time-comparison">Time Comparison</h3> <p>Use the following macros when comparing two millis count values:</p> <ul> <li> <code class="highlighter-rouge">PENDING(ms,time)</code>: Relative to <code class="highlighter-rouge">ms</code>, <code class="highlighter-rouge">time</code> is pending.</li> <li> <code class="highlighter-rouge">ELAPSED(ms,time)</code>: Relative to <code class="highlighter-rouge">ms</code>, <code class="highlighter-rouge">time</code> has elapsed.</li> </ul> <p>When using <code class="highlighter-rouge">ELAPSED</code> and <code class="highlighter-rouge">PENDING</code>, always compare against the <em>next time</em> rather than the <em>last time</em>. Thisâ¦</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="k">const</span> <span class="n">millis_t</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ELAPSED</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">next_event_ms</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">next_event_ms</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">+</span> <span class="n">TIME_INTERVAL</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre> </div> <p>â¦will be smaller and faster than thisâ¦</p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="k">const</span> <span class="n">millis_t</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ELAPSED</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">last_event_ms</span> <span class="o">+</span> <span class="n">TIME_INTERVAL</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">last_event_ms</span> <span class="o">=</span> <span class="n">ms</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre> </div> <h3 id="serial-macros">Serial Macros</h3> <p>The <code class="highlighter-rouge">serial.h</code> file also includes several macros to make it easier to create PROGMEM strings and print them to the serial output. Below are a few of them. See the <code class="highlighter-rouge">serial.h</code> file for others.</p> <table class="pretty-list headless"> <thead> <tr> <th>Macro</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">SERIAL_ECHO_START()</code></td> <td>Send â<code class="highlighter-rouge">echo:</code>â to the serial output.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_ERROR_START()</code></td> <td>Print â<code class="highlighter-rouge">error:</code>â to the serial output.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_PROTOCOL("hello")</code></td> <td>Print an ASCII string stored in SRAM to serial out.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_PROTOCOLLN("hello")</code></td> <td>Print an ASCII string stored in SRAM to serial out, appending a newline.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_PROTOCOLPGM("hello")</code></td> <td>Wrap the given ASCII string in <code class="highlighter-rouge">PSTR</code> and print it to serial out.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_PROTOCOLLNPGM("hello")</code></td> <td>Wrap the given ASCII string in <code class="highlighter-rouge">PSTR</code> and print it to serial out, appending a newline.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_PROTOCOLPAIR("Hello:",val)</code></td> <td>Wrap an ASCII string in <code class="highlighter-rouge">PSTR</code>; print it and a value to serial out.</td> </tr> <tr> <td><code class="highlighter-rouge">SERIAL_PROTOCOLLNPAIR("Hello:",val)</code></td> <td>Wrap an ASCII string in <code class="highlighter-rouge">PSTR</code>; print it, a value, and a newline to serial out.</td> </tr> <tr> <td> <code class="highlighter-rouge">SERIAL_ECHO(S)</code><br><code class="highlighter-rouge">SERIAL_ECHOLN(S)</code><br><code class="highlighter-rouge">SERIAL_ECHOPGM(S)</code><br><code class="highlighter-rouge">SERIAL_ECHOLNPGM(S)</code><br><code class="highlighter-rouge">SERIAL_ECHOPAIR(S,V)</code><br><code class="highlighter-rouge">SERIAL_ECHOLNPAIR(S,V)</code> </td> <td>just like the <code class="highlighter-rouge">PROTOCOL_*</code> macros above.</td> </tr> <tr> <td> <code class="highlighter-rouge">SERIAL_ERROR(S)</code><br><code class="highlighter-rouge">SERIAL_ERRORLN(S)</code><br><code class="highlighter-rouge">SERIAL_ERRORPGM(S)</code> </td> <td>Â </td> </tr> </tbody> </table> <h3 id="maths-macros">Maths macros</h3> <p>Use the following macros in place of their normal lower-case versions. These ensure the smaller 32-bit <code class="highlighter-rouge">float</code> on all architectures. The initial 32-bit targets for Marlin, while significantly faster, do not have a floating-point unit either, so <code class="highlighter-rouge">float</code> maths is more compatible while not sacrificing performance.</p> <ul> <li><code class="highlighter-rouge">ATAN2(y, x)</code></li> <li><code class="highlighter-rouge">FABS(x)</code></li> <li><code class="highlighter-rouge">POW(x, y)</code></li> <li><code class="highlighter-rouge">SQRT(x)</code></li> <li><code class="highlighter-rouge">CEIL(x)</code></li> <li><code class="highlighter-rouge">FLOOR(x)</code></li> <li><code class="highlighter-rouge">LROUND(x)</code></li> <li><code class="highlighter-rouge">FMOD(x, y)</code></li> <li><code class="highlighter-rouge">HYPOT(x,y)</code></li> </ul> <h3 id="adding-a-new-feature">Adding a New Feature</h3> <p>Since Marlin needs to runs on the most modest hardware, much care has been taken to keep code size small and avoid overtaxing the CPU. AVR and some 32-bit CPUs have no FPU, so itâs best to avoid floating point operations whenever possible, and add-on features should also conserve SRAM. Right out of the gate, the default configuration of Marlin 1.1 uses over 2.6K of SRAM, and wonât fit on an UNO.</p> <ul> <li> <code class="highlighter-rouge">#define</code> is used liberally, especially for configuration values</li> <li>Use <code class="highlighter-rouge">#define MYFEATURE</code> for feature switches.</li> <li>Feature settings have some flexibility, and can have values.</li> <li>Use <code class="highlighter-rouge">#if ENABLED(MYFEATURE)</code> / <code class="highlighter-rouge">#if DISABLED(MYFEATURE)</code> rather than <code class="highlighter-rouge">#ifdef</code> or <code class="highlighter-rouge">#if defined()</code>. The <code class="highlighter-rouge">ENABLED</code>/<code class="highlighter-rouge">DISABLED</code> macros allow features to be overridden by <code class="highlighter-rouge">make</code>.</li> <li>Indent <code class="highlighter-rouge">#ifâ¦</code>/<code class="highlighter-rouge">#endif</code> blocks and their contents with the rest of the cascade. This allows editors that only have naive code-folding to fold blocks properly.</li> <li>Add a comment: <code class="highlighter-rouge">#endif // MYFEATURE</code> â but only if the <code class="highlighter-rouge">#endif</code> is far away (lets say, over 10 lines) from the starting <code class="highlighter-rouge">#if</code>.</li> </ul> <h4 id="new-feature-example">New Feature Example</h4> <p><strong>In Configuration.h:</strong></p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="c1">// Enable this to make something new happen
</span><span class="cp">#define MYFEATURE
#if ENABLED(MYFEATURE)
</span>  <span class="cp">#define MYFEATURE_SETTING 12.5
</span>  <span class="cp">#undef OVERRIDDEN_FEATURE // This won't be needed with MYFEATURE
#endif
</span></code></pre> </div> <p><strong>In SanityCheck.h:</strong></p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cm">/**
 * My feature
 */</span>
<span class="cp">#if ENABLED(MYFEATURE) &amp;&amp; ENABLED(INCOMPAT_FEATURE)
</span>  <span class="cp">#error MYFEATURE is not compatible with INCOMPAT_FEATURE
#endif
</span></code></pre> </div> <p><strong>In Conditionals.h:</strong></p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="cm">/**
 * My feature
 */</span>
<span class="cp">#if ENABLED(MYFEATURE)
</span>  <span class="cp">#undef OVERRIDDEN_FEATURE // This feature is disabled by MYFEATURE
</span>  <span class="cp">#undef OVERRIDDEN_SETTING // This setting will always be 1234 with MYFEATURE
</span>  <span class="cp">#define OVERRIDDEN_SETTING 1234
#endif
</span></code></pre> </div> <p><strong>In Marlin_main.cpp, for example:</strong></p> <div class="language-cpp highlighter-rouge"> <pre class="highlight"><code><span class="c1">// My Feature, when Your Feature is disabled
</span><span class="cp">#if ENABLED(MYFEATURE) &amp;&amp; DISABLED(YOURFEATURE)
</span>  <span class="n">my_feature_function</span><span class="p">();</span> <span class="c1">// Run my feature, possible an inline function taking refs
</span>  <span class="cp">#if ENABLED(HISFEATURE)
</span>    <span class="p">...</span>
    <span class="n">call_something</span><span class="p">();</span>
    <span class="p">...</span>
  <span class="cp">#else // !HISFEATURE
</span>    <span class="p">...</span>
    <span class="n">call_something_else</span><span class="p">();</span>
    <span class="p">...</span>
  <span class="cp">#endif // !HISFEATURE
#endif // MYFEATURE
</span></code></pre> </div> </div> </div> </div> </div> </div> <footer> <div class="container"> <div class="row"> <div class="col-lg-12"> <hr> </div> </div> <div class="row"> <div class="col-lg-8"> <p>Brought to you with <i class="fa fa-heart text-danger" aria-hidden="true"></i> lack of <i class="fa fa-bed" aria-hidden="true"></i> and lots of <i class="fa fa-coffee" aria-hidden="true"></i>. <br> The contents of this website are Â© 2018 under the terms of the <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a> License.</p> </div> <div class="col-lg-4"> <div class="pull-right"> <a href="#top" data-proofer-ignore> Back to top <i class="fa fa-level-up" aria-hidden="true"></i></a> </div> </div> </div> </div> </footer> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76230130-1', {
          'cookieDomain': 'marlinfw.org',
          'siteSpeedSampleRate': 80
      });

      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script> </body> </html>