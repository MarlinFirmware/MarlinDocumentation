<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Coding Standards | Marlin 3D Printer Firmware</title> <meta property="og:title" content="Coding Standards"> <meta name="author" content="thinkyhead"> <meta property="og:locale" content="en_US"> <meta name="description" content="Guidelines for Marlin code formatting, methodologies, and standards."> <meta property="og:description" content="Guidelines for Marlin code formatting, methodologies, and standards."> <link rel="canonical" href="http://marlinfw.org/docs/development/coding_standards.html"> <meta property="og:url" content="http://marlinfw.org/docs/development/coding_standards.html"> <meta property="og:site_name" content="Marlin 3D Printer Firmware"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2017-05-13T08:25:59+01:00"> <script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Coding Standards","author":{"@type":"Person","name":"thinkyhead"},"datePublished":"2017-05-13T08:25:59+01:00","dateModified":"2017-05-13T08:25:59+01:00","description":"Guidelines for Marlin code formatting, methodologies, and standards.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://marlinfw.org/assets/images/logo/marlin/small.png"},"name":"thinkyhead"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://marlinfw.org/docs/development/coding_standards.html"},"url":"http://marlinfw.org/docs/development/coding_standards.html"}</script> <link rel="icon" href="/assets/favicon.ico"> <link rel="stylesheet" href="/assets/stylesheets/main.css"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script src="/assets/javascript/head.min.js"></script> <script type="text/javascript">
      /**
       * As Github pages do not support https for custom domains
       * this is the current best workaround for #18.
       */
      var domains  = ['marlinfw.org', 'localhost', '127.0.0.1' ];
      var pathname = location.pathname.replace(/^\/MarlinDocumentation/, '')
      if (domains.indexOf(window.location.hostname) == -1)
          window.top.location.href = 'http://marlinfw.org' + pathname;

      /**
       * Another ugly workaround trying to improve UX reported by #35
       */
       if (location.protocol != 'http:')
           location.href = 'http:' + window.location.href.substring(window.location.protocol.length);

      /**
       * Improves overall speed by loading javascript and css resources in parallel
       * with the main page.
       */
      head.load(
          "/assets/stylesheets/font-awesome.min.css",

          "/assets/javascript/jquery-2.2.1.min.js",
          "/assets/javascript/jquery-ui.min.js",
          "/assets/javascript/bootstrap.min.js",
          "/assets/javascript/tocify.min.js",
          "/assets/javascript/custom.js",

          "/assets/javascript/sheetrock.min.js",
          "/assets/javascript/cookieconsent.min.js"
      );

      head.ready(function() {
        window.cookieconsent_options = {
          "message":"We uses cookies to ensure you get the best experience on our website",
          "dismiss": "Got it!", "learnMore": "More info", "link":"", "theme": "dark-bottom"
        };
      });
    </script> </head> <body role="document"> <nav class="navbar navbar-default navbar-fixed-top custom-no-margin"> <div class="container"> <div class="navbar-header"> <a href="/" class="navbar-brand"> <img src="/assets/images/logo/marlin/text-25.png" alt="Marlin"> </a> <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> </div> <div class="navbar-collapse collapse" id="navbar-main"> <ul class="nav navbar-nav"> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-getting-started"> Getting Started <span class="caret"></span> </a> <ul class="dropdown-menu"> <li><a href="/docs/basics/introduction.html"> Introduction </a></li> <li class="divider"> </li> <li><a href="/meta/download/"> Download Marlin </a></li> <li><a href="/docs/basics/install.html"> Installing Marlin </a></li> <li><a href="/docs/configuration/configuration.html"> Configuring Marlin </a></li> <li class="divider"> </li> <li><a href="/docs/basics/reporting_bugs.html"> Reporting bugs </a></li> </ul> </li> <li><a href="/meta/download/"> Download </a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-documentation"> Documentation <span class="caret"></span> </a> <ul class="dropdown-menu"> <li class="dropdown-submenu configuration"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration</a> <ul class="dropdown-menu"> <li><a href="/meta/configuration/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/configuration/configuration.html"> Configuring Marlin 1.1 </a></li> <li><a href="/docs/configuration/probes.html"> Probe Configuration </a></li> </ul> </li> <li class="dropdown-submenu development"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development</a> <ul class="dropdown-menu"> <li><a href="/meta/development/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/development/boards.html"> Boards </a></li> <li><a href="/docs/development/coding_standards.html"> Coding Standards </a></li> <li><a href="/docs/development/contributing.html"> Contributing to Marlin </a></li> <li><a href="/docs/development/getting_started_pull_requests.html"> Contributing Code with Pull Requests </a></li> <li><a href="/docs/development/feature_request.html"> Feature requests </a></li> <li><a href="/docs/development/fonts.html"> Adding new fonts </a></li> </ul> </li> <li class="dropdown-submenu gcode"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">G-Code</a> <ul class="dropdown-menu"> <li><a href="/meta/gcode/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/gcode/G000-G001.html"> G0-G1: Linear Move </a></li> <li><a href="/docs/gcode/G002-G003.html"> G2-G3: Controlled Arc Move </a></li> <li><a href="/docs/gcode/G004.html"> G4: Dwell </a></li> <li><a href="/docs/gcode/G005.html"> G5: Bézier cubic spline </a></li> <li><a href="/docs/gcode/G010.html"> G10: Retract </a></li> <li><a href="/docs/gcode/G011.html"> G11: Recover </a></li> <li><a href="/docs/gcode/G012.html"> G12: Clean the Nozzle </a></li> <li><a href="/docs/gcode/G020.html"> G20: Inch Units </a></li> <li><a href="/docs/gcode/G021.html"> G21: Millimeter Units </a></li> <li><a href="/docs/gcode/G026.html"> G26: Mesh Validation Pattern </a></li> <li><a href="/docs/gcode/G027.html"> G27: Park the nozzle </a></li> <li><a href="/docs/gcode/G028.html"> G28: Auto Home </a></li> <li><a href="/docs/gcode/G029-mbl.html"> G29: Mesh Bed Leveling </a></li> <li><a href="/docs/gcode/G029-abl.html"> G29: Automatic Bed Leveling </a></li> <li><a href="/docs/gcode/G029-ubl.html"> G29: Unified Bed Leveling - Coming Soon! </a></li> <li><a href="/docs/gcode/G030.html"> G30: Single Z-Probe </a></li> <li><a href="/docs/gcode/G031.html"> G31: Dock Sled </a></li> <li><a href="/docs/gcode/G032.html"> G32: Undock Sled </a></li> <li><a href="/docs/gcode/G033.html"> G33: Delta Auto Calibration </a></li> <li><a href="/docs/gcode/G038.html"> G38.2-G38.3: Probe target </a></li> <li><a href="/docs/gcode/G090.html"> G90: Absolute Positioning </a></li> <li><a href="/docs/gcode/G091.html"> G91: Relative Positioning </a></li> <li><a href="/docs/gcode/G092.html"> G92: Set Position </a></li> <li><a href="/docs/gcode/M000-M001.html"> M0-M1: Unconditional stop </a></li> <li><a href="/docs/gcode/M017.html"> M17: Enable Steppers </a></li> <li><a href="/docs/gcode/M018.html"> M18-M84: Disable steppers </a></li> <li><a href="/docs/gcode/M020.html"> M20: List SD Card </a></li> <li><a href="/docs/gcode/M021.html"> M21: Init SD card </a></li> <li><a href="/docs/gcode/M022.html"> M22: Release SD card </a></li> <li><a href="/docs/gcode/M023.html"> M23: Select SD file </a></li> <li><a href="/docs/gcode/M024.html"> M24: Start or Resume SD print </a></li> <li><a href="/docs/gcode/M025.html"> M25: Pause SD print </a></li> <li><a href="/docs/gcode/M026.html"> M26: Set SD position </a></li> <li><a href="/docs/gcode/M027.html"> M27: Report SD print status </a></li> <li><a href="/docs/gcode/M028.html"> M28: Start SD write </a></li> <li><a href="/docs/gcode/M029.html"> M29: Stop SD write </a></li> <li><a href="/docs/gcode/M030.html"> M30: Delete SD file </a></li> <li><a href="/docs/gcode/M031.html"> M31: Print time </a></li> <li><a href="/docs/gcode/M032.html"> M32: Select and Start </a></li> <li><a href="/docs/gcode/M033.html"> M33: Get Long Path </a></li> <li><a href="/docs/gcode/M034.html"> M34: SDCard Sorting </a></li> <li><a href="/docs/gcode/M042.html"> M42: Set Pin State </a></li> <li><a href="/docs/gcode/M043.html"> M43: Debug Pins </a></li> <li><a href="/docs/gcode/M048.html"> M48: Probe Accuracy Test </a></li> <li><a href="/docs/gcode/M075.html"> M75: Start Print Job </a></li> <li><a href="/docs/gcode/M076.html"> M76: Pause Print Job </a></li> <li><a href="/docs/gcode/M077.html"> M77: Stop Print Job </a></li> <li><a href="/docs/gcode/M078.html"> M78: Print Job Stats </a></li> <li><a href="/docs/gcode/M080.html"> M80: Power On </a></li> <li><a href="/docs/gcode/M081.html"> M81: Power Off </a></li> <li><a href="/docs/gcode/M082.html"> M82: E Absolute </a></li> <li><a href="/docs/gcode/M083.html"> M83: E Relative </a></li> <li><a href="/docs/gcode/M085.html"> M85: Inactivity Shutdown </a></li> <li><a href="/docs/gcode/M092.html"> M92: Set Axis Steps-per-unit </a></li> <li><a href="/docs/gcode/M100.html"> M100: Free Memory </a></li> <li><a href="/docs/gcode/M104.html"> M104: Set Hotend Temperature </a></li> <li><a href="/docs/gcode/M105.html"> M105: Report Temperatures </a></li> <li><a href="/docs/gcode/M106.html"> M106: Set Fan Speed </a></li> <li><a href="/docs/gcode/M107.html"> M107: Fan Off </a></li> <li><a href="/docs/gcode/M108.html"> M108: Break and Continue </a></li> <li><a href="/docs/gcode/M109.html"> M109: Wait for Hotend Temperature </a></li> <li><a href="/docs/gcode/M110.html"> M110: Set Line Number </a></li> <li><a href="/docs/gcode/M111.html"> M111: Debug Level </a></li> <li><a href="/docs/gcode/M112.html"> M112: Emergency Stop </a></li> <li><a href="/docs/gcode/M113.html"> M113: Host Keepalive </a></li> <li><a href="/docs/gcode/M114.html"> M114: Get Current Position </a></li> <li><a href="/docs/gcode/M115.html"> M115: Firmware Info </a></li> <li><a href="/docs/gcode/M117.html"> M117: Set LCD Message </a></li> <li><a href="/docs/gcode/M119.html"> M119: Endstop States </a></li> <li><a href="/docs/gcode/M120.html"> M120: Enable Endstops </a></li> <li><a href="/docs/gcode/M121.html"> M121: Disable Endstops </a></li> <li><a href="/docs/gcode/M125.html"> M125: Park Head </a></li> <li><a href="/docs/gcode/M126.html"> M126: Baricuda 1 Open </a></li> <li><a href="/docs/gcode/M127.html"> M127: Baricuda 1 Close </a></li> <li><a href="/docs/gcode/M128.html"> M128: Baricuda 2 Open </a></li> <li><a href="/docs/gcode/M129.html"> M129: Baricuda 2 Close </a></li> <li><a href="/docs/gcode/M140.html"> M140: Set Bed Temperature </a></li> <li><a href="/docs/gcode/M145.html"> M145: Set Material Preset </a></li> <li><a href="/docs/gcode/M149.html"> M149: Set Temperature Units </a></li> <li><a href="/docs/gcode/M150.html"> M150: Set RGB Color </a></li> <li><a href="/docs/gcode/M155.html"> M155: Temperature Auto-Report </a></li> <li><a href="/docs/gcode/M163.html"> M163: Set Mix Factor </a></li> <li><a href="/docs/gcode/M164.html"> M164: Save Mix </a></li> <li><a href="/docs/gcode/M165.html"> M165: Set Mix </a></li> <li><a href="/docs/gcode/M190.html"> M190: Wait for Bed Temperature </a></li> <li><a href="/docs/gcode/M200.html"> M200: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M201.html"> M201: Set Print Max Acceleration </a></li> <li><a href="/docs/gcode/M203.html"> M203: Set Max Feedrate </a></li> <li><a href="/docs/gcode/M204.html"> M204: Set Starting Acceleration </a></li> <li><a href="/docs/gcode/M205.html"> M205: Set Advanced Settings </a></li> <li><a href="/docs/gcode/M206.html"> M206: Set Home Offsets </a></li> <li><a href="/docs/gcode/M207.html"> M207: Set Firmware Retraction </a></li> <li><a href="/docs/gcode/M208.html"> M208: Set Firmware Recovery </a></li> <li><a href="/docs/gcode/M209.html"> M209: Set Auto Retract </a></li> <li><a href="/docs/gcode/M211.html"> M211: Software Endstops </a></li> <li><a href="/docs/gcode/M218.html"> M218: Set Hotend Offset </a></li> <li><a href="/docs/gcode/M220.html"> M220: Set Feedrate Percentage </a></li> <li><a href="/docs/gcode/M221.html"> M221: Set Flow Percentage </a></li> <li><a href="/docs/gcode/M226.html"> M226: Wait for Pin State </a></li> <li><a href="/docs/gcode/M240.html"> M240: Trigger Camera </a></li> <li><a href="/docs/gcode/M250.html"> M250: LCD Contrast </a></li> <li><a href="/docs/gcode/M260.html"> M260: I2C Send </a></li> <li><a href="/docs/gcode/M261.html"> M261: I2C Request </a></li> <li><a href="/docs/gcode/M280.html"> M280: Servo Position </a></li> <li><a href="/docs/gcode/M300.html"> M300: Play Tone </a></li> <li><a href="/docs/gcode/M301.html"> M301: Set Hotend PID </a></li> <li><a href="/docs/gcode/M302.html"> M302: Cold Extrude </a></li> <li><a href="/docs/gcode/M303.html"> M303: PID autotune </a></li> <li><a href="/docs/gcode/M304.html"> M304: Set Bed PID </a></li> <li><a href="/docs/gcode/M350.html"> M350: Set micro-stepping </a></li> <li><a href="/docs/gcode/M351.html"> M351: Set Microstep Pins </a></li> <li><a href="/docs/gcode/M355.html"> M355: Case Light Control </a></li> <li><a href="/docs/gcode/M360.html"> M360: SCARA Theta A </a></li> <li><a href="/docs/gcode/M361.html"> M361: SCARA Theta-B </a></li> <li><a href="/docs/gcode/M362.html"> M362: SCARA Psi-A </a></li> <li><a href="/docs/gcode/M363.html"> M363: SCARA Psi-B </a></li> <li><a href="/docs/gcode/M364.html"> M364: SCARA Psi-C </a></li> <li><a href="/docs/gcode/M380.html"> M380: Activate Solenoid </a></li> <li><a href="/docs/gcode/M381.html"> M381: Deactivate Solenoids </a></li> <li><a href="/docs/gcode/M400.html"> M400: Finish Moves </a></li> <li><a href="/docs/gcode/M401.html"> M401: Deploy Probe </a></li> <li><a href="/docs/gcode/M402.html"> M402: Stow Probe </a></li> <li><a href="/docs/gcode/M404.html"> M404: Set Filament Diameter </a></li> <li><a href="/docs/gcode/M405.html"> M405: Filament Width Sensor On </a></li> <li><a href="/docs/gcode/M406.html"> M406: Filament Width Sensor Off </a></li> <li><a href="/docs/gcode/M407.html"> M407: Filament Width </a></li> <li><a href="/docs/gcode/M410.html"> M410: Quickstop </a></li> <li><a href="/docs/gcode/M420.html"> M420: Bed Leveling State </a></li> <li><a href="/docs/gcode/M421.html"> M421: Set Mesh Value </a></li> <li><a href="/docs/gcode/M428.html"> M428: Home Offsets Here </a></li> <li><a href="/docs/gcode/M500.html"> M500: Save Settings </a></li> <li><a href="/docs/gcode/M501.html"> M501: Restore Settings </a></li> <li><a href="/docs/gcode/M502.html"> M502: Factory Reset </a></li> <li><a href="/docs/gcode/M503.html"> M503: Report Settings </a></li> <li><a href="/docs/gcode/M540.html"> M540: Endstops Abort SD </a></li> <li><a href="/docs/gcode/M600.html"> M600: Filament Change </a></li> <li><a href="/docs/gcode/M605.html"> M605: Dual Nozzle Mode </a></li> <li><a href="/docs/gcode/M665.html"> M665: Coming Soon </a></li> <li><a href="/docs/gcode/M666.html"> M666: Coming Soon </a></li> <li><a href="/docs/gcode/M851.html"> M851: Z Probe Offset </a></li> <li><a href="/docs/gcode/M906.html"> M906: TMC Motor Current </a></li> <li><a href="/docs/gcode/M907.html"> M907: Set Motor Current </a></li> <li><a href="/docs/gcode/M908.html"> M908: Set Trimpot Pins </a></li> <li><a href="/docs/gcode/M909.html"> M909: DAC Print Values </a></li> <li><a href="/docs/gcode/M910.html"> M910: Commit DAC to EEPROM </a></li> <li><a href="/docs/gcode/M911.html"> M911: TMC OT Pre-Warn Condition </a></li> <li><a href="/docs/gcode/M912.html"> M912: Clear TMC OT Pre-Warn </a></li> <li><a href="/docs/gcode/M913.html"> M913: Set Hybrid Threshold Speed </a></li> <li><a href="/docs/gcode/M914.html"> M914: TMC Bump Sensitivity </a></li> <li><a href="/docs/gcode/M928.html"> M928: Start SD Write </a></li> <li><a href="/docs/gcode/M999.html"> M999: Coming Soon </a></li> </ul> </li> <li class="dropdown-submenu features"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Marlin Features</a> <ul class="dropdown-menu"> <li><a href="/meta/features/"> All documents </a></li> <li class="divider"> </li> <li><a href="/docs/features/auto_bed_leveling.html"> Automatic Bed Leveling </a></li> <li><a href="/docs/features/lin_advance.html"> Linear Advance </a></li> <li><a href="/docs/features/unified_bed_leveling.html"> Unified Bed Leveling </a></li> </ul> </li> <li class="divider"> </li> <li><a href="/meta/needs-review/"> Documentation Needing Review </a></li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-tools"> Tools <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/tools/u8glib/converter.html"> Customize the Bootscreen </a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin/issues"> Bugtracker </a></li> <li><a href="/docs/basics/reporting_bugs.html"> Reporting bugs </a></li> <li class="divider"> </li> <li><a href="https://github.com/MarlinFirmware/Marlin"> Source Code Repository </a></li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right visible-lg-block"> <li><a href="https://github.com/MarlinFirmware/MarlinDocumentation/edit/master/_development/coding_standards.md" data-proofer-ignore> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Improve this page</span> </a></li> </ul> </div> </div> </nav> <div class="container" role="main"> <div class="row"> <div class="col-lg-3 col-md-4 visible-lg-block visible-md-block custom-no-padding"> <div class="custom-fixed-sidebar"> <div id="toc"></div> </div> </div> <div class="col-lg-9 col-md-8 custom-bg-white"> <div class="row"> <div class="col-md-12 custom-article"> <p class="text-right pull-right visible-lg-block hidden-print small custom-pt25"> <a href="https://github.com/thinkyhead" data-toggle="tooltip" data-placement="bottom" title="Visit thinkyhead's profile on Github"><img class="avatar avatar-small" src="https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=30" alt="thinkyhead" srcset="https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=30 1x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=60 2x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=90 3x, https://avatars1.githubusercontent.com/thinkyhead?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a> </p> <h1 class="custom-article-header">Coding Standards</h1> <hr> <p>Please follow these formatting guidelines and coding standards when contributing code to Marlin. Pull requests that don’t follow good coding standards will be postponed for cleanup.</p> <h2 id="coding-style">Coding Style</h2> <h3 id="indentation">Indentation</h3> <p>Indentation is important for readability and maintainability of code, and provides guidance for naïve code editors (e.g., TextMate, Sublime, et. al.) to properly fold code blocks by level.</p> <ul> <li>2 spaces. Don’t use tabs at all. <em>Set your editor to use spaces! Tabs will bite you in the end.</em> </li> <li>All blocks indented, including <code class="highlighter-rouge">#if</code> blocks and other non-brace compiler blocks</li> </ul> <pre>
void myFunction() {
  if (myCondition == 0) {
    #ifdef PETER_PARKER
      slingWeb(100);
    #else
      findPhoneBooth();
    #endif
  }
}
</pre> <h3 id="bracket-style">Bracket-style</h3> <p>We’ve chosen a bracket (i.e., ‘‘brace’’) style that shows the most code lines on screen, and which causes folded code blocks to appear at the end of the line where they begin. If vertical spacing makes code more readable, add a blank line rather than using a different bracket style.</p> <ul> <li>“One True Bracket” Style – “1TBS” – to rule them all</li> <li>Almost all opening braces at the end of lines, including declarations:</li> </ul> <pre>
if (...) {
  ...
}
else {
  ...
}
</pre> <ul> <li>Closing braces should always align with the starting column of the opening line</li> </ul> <h3 id="spacing">Spacing</h3> <ul> <li>One space between keywords and their conditions:<br><code class="highlighter-rouge">if (…)</code>, <code class="highlighter-rouge">while (…)</code>, <code class="highlighter-rouge">do {…} while(…)</code> etc.</li> <li>No space between functions and their arguments:<br><code class="highlighter-rouge">myFunction(…);</code> </li> <li>Spaces between operators, most of the time:<br><code class="highlighter-rouge">myVar = aVar + bVar * cVar;</code><br><code class="highlighter-rouge">myVal = (a*b + b*c); // grouping</code> </li> </ul> <h3 id="comments">Comments</h3> <ul> <li>Doxygen-style headings (documenting in .h files), C++ single-line style // for under 3 lines</li> <li>Multi-line use asterisks in the second column</li> </ul> <h2 id="names-and-symbols">Names and Symbols</h2> <h3 id="capitalization">Capitalization</h3> <ul> <li><code class="highlighter-rouge">your_function_name(int in_integer, float in_float=0.0)</code></li> <li><code class="highlighter-rouge">MyClass</code></li> <li><code class="highlighter-rouge">ClassMethod</code></li> <li><code class="highlighter-rouge">classData</code></li> <li><code class="highlighter-rouge">local_variable</code></li> <li><code class="highlighter-rouge">global_variable</code></li> <li> <code class="highlighter-rouge">MACRO_NAME</code> – anything created with <code class="highlighter-rouge">#define</code> </li> <li><code class="highlighter-rouge">EnumeratedType</code></li> </ul> <h3 id="filenames">Filenames</h3> <ul> <li>use <code class="highlighter-rouge">.cpp</code> for C++ sources</li> <li>use <code class="highlighter-rouge">.c</code> for C only sources</li> <li>use <code class="highlighter-rouge">.h</code> for headers of all types</li> </ul> <h3 id="directories">Directories</h3> <ul> <li>Lowercase names.</li> <li>Note that Arduino cannot (easily) compile code in a sketch subfolder</li> </ul> <h3 id="libraries">Libraries</h3> <p>Whenever possible use functions supplied by avr-libc or Arduino bundled libraries. Any libraries required to compile Marlin should be included in the package so that they are guaranteed to be compatible versions.</p> <h2 id="extended-language-features">Extended Language Features</h2> <p>Marlin is written in C/C++ and must be able to compile with the supplied Makefile and an up-to-date version of Arduino. Backward-compatibility to earlier versions of Arduino is not required, but we can deal with this on an issue-to-issue basis.</p> <h3 id="primitive-types">Primitive Types</h3> <ul> <li>On AVR both <code class="highlighter-rouge">int</code> and <code class="highlighter-rouge">short</code> are 16-bits, and <code class="highlighter-rouge">long</code> is 32 bits.</li> </ul> <h3 id="memory-usage">Memory Usage</h3> <ul> <li>DO NOT use dynamic memory allocations such as <code class="highlighter-rouge">malloc()</code>, <code class="highlighter-rouge">free()</code>, <code class="highlighter-rouge">new</code>, <code class="highlighter-rouge">delete</code> </li> <li>’‘(Some exceptions may be considered, with caveats!)’’</li> </ul> <h3 id="no-extended-features">No Extended Features</h3> <ul> <li>DO NOT use extended C++ features like:</li> <li>Exceptions (throw / catch)</li> <li>Virtual functions / classes</li> <li>Templates</li> <li>Standard Template Library (STL)</li> </ul> <h3 id="avoid-expensive-code">Avoid Expensive Code</h3> <ul> <li> <code class="highlighter-rouge">millis()</code> can be expensive so put it in a <code class="highlighter-rouge">uint32_t</code> if you need it more than once.</li> <li>Pre-calculate if possible instead of calculating on the fly</li> </ul> <h2 id="marlin-specific-conventions">Marlin-specific Conventions</h2> <h3 id="preprocessor-directives">Preprocessor directives</h3> <ul> <li>Use <code class="highlighter-rouge">#define</code> instead of <code class="highlighter-rouge">const</code> for configurable values (for now)</li> <li>Don’t use <code class="highlighter-rouge">#if</code> / <code class="highlighter-rouge">#endif</code> for commenting-out unused, old or broken code. We have a git repository! If it’s obsolete, delete it.</li> <li>Use <code class="highlighter-rouge">#if ENABLED(FEATURE_NAME)</code> / <code class="highlighter-rouge">#endif</code> to compile enabled features. (Using these macros allows features to be set externally.)</li> <li>Use <code class="highlighter-rouge">#if DISABLED(FEATURE_NAME)</code> / <code class="highlighter-rouge">#endif</code> to compile disabled features. (Using these macros allows features to be set externally.)</li> <li>Use <code class="highlighter-rouge">#define</code> macros to avoid repeating boilerplate code.<br>Consider both readability and maintainability.</li> <li>Label <code class="highlighter-rouge">#endif</code> with the opening <code class="highlighter-rouge">#if</code> condition(s) if the block is over ~15 lines. Make the label compact. For example, <code class="highlighter-rouge">#endif // SDSUPPORT || ULTRALCD</code>.</li> </ul> <h3 id="adding-a-new-feature">Adding a New Feature</h3> <p>Since Marlin is an Arduino firmware and not a desktop application, much care has been taken to keep code size at a minimum, and to avoid using any features that may overtax the hardware, including demanding math operations. New features should try to conserve the limited resources available and allocate a fixed amount of memory (apart from <code class="highlighter-rouge">auto</code> variables) to do their work.</p> <ul> <li> <code class="highlighter-rouge">#define</code> is used liberally, especially for configuration values</li> <li>Use <code class="highlighter-rouge">#define MYFEATURE</code> for feature switches.</li> <li>Feature settings have some flexibility, and can have values.</li> <li>Test features with <code class="highlighter-rouge">#if ENABLED(MYFEATURE)</code> / <code class="highlighter-rouge">#if DISABLED(MYFEATURE)</code>. (Using these macros allows features to be set externally.)</li> <li>Indent the code between <code class="highlighter-rouge">#if…</code> and <code class="highlighter-rouge">#endif</code> for editors that only have naive code-folding.</li> <li>Add a comment: <code class="highlighter-rouge">#endif // MYFEATURE</code> — Only if the <code class="highlighter-rouge">#endif</code> is ‘‘far away’’!</li> </ul> <h4 id="new-feature-example">New Feature Example</h4> <p><strong>In Configuration.h:</strong></p> <pre>
// Enable this to make something new happen
#define MYFEATURE
#if ENABLED(MYFEATURE)
  #define MYFEATURE_SETTING 12.5
  #undef OVERRIDDEN_FEATURE // This won't be needed with MYFEATURE
#endif
</pre> <p><strong>In SanityCheck.h:</strong></p> <pre>
/**
 * My feature
 */
#if ENABLED(MYFEATURE) &amp;&amp; ENABLED(INCOMPAT_FEATURE)
  #error MYFEATURE is not compatible with INCOMPAT_FEATURE
#endif
</pre> <p><strong>In Conditionals.h:</strong></p> <pre>
/**
 * My feature
 */
#if ENABLED(MYFEATURE)
  #undef OVERRIDDEN_FEATURE // This feature is disabled by MYFEATURE
  #undef OVERRIDDEN_SETTING // This setting will always be 1234 with MYFEATURE
  #define OVERRIDDEN_SETTING 1234
#endif
</pre> <p><strong>In Marlin_main.cpp, for example:</strong></p> <pre>
// My Feature, when Your Feature is disabled
#if ENABLED(MYFEATURE) &amp;&amp; DISABLED(YOURFEATURE)
  my_feature_function(); // Run my feature, possible an inline function taking refs
  #if ENABLED(HISFEATURE)
    ...
    call_something();
    ...
  #else // !HISFEATURE
    ...
    call_something_else();
    ...
  #endif // !HISFEATURE
#endif // MYFEATURE
</pre> </div> </div> </div> </div> </div> <footer> <div class="container"> <div class="row"> <div class="col-lg-12"> <hr> </div> </div> <div class="row"> <div class="col-lg-8"> <p>Brought to you with <i class="fa fa-heart text-danger" aria-hidden="true"></i> lack of <i class="fa fa-bed" aria-hidden="true"></i> and lots of <i class="fa fa-coffee" aria-hidden="true"></i>. <br> The contents of this website are © 2017 under the terms of the <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a> License.</p> </div> <div class="col-lg-4"> <div class="pull-right"> <a href="#top" data-proofer-ignore> Back to top <i class="fa fa-level-up" aria-hidden="true"></i></a> </div> </div> </div> </div> </footer> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-76230130-1', {
          'cookieDomain': 'marlinfw.org',
          'siteSpeedSampleRate': 80
      });

      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script> </body> </html>